:: Multiple Organ Implant [nobr]

You head down to your <<if $surgeryUpgrade == 1>>heavily upgraded and customized remote surgery<<else>>remote surgery<</if>> and start having the slaves with <<if ($completedOrgans.length > 0) && ($limbsCompleted > 0)>>organs or limbs <<elseif ($completedOrgans.length > 1)>>organs <<elseif ($limbsCompleted > 1)>>sets of limbs <</if>>that are ready be sent down.

/* builds a list for each slave and adds the appropriate organs to it */
<<for _i = 0; _i < $slaves.length; _i++>>
	<<set $activeSlave = $slaves[_i]>>
	<<set _slaveOrgans = {
		penis: 0,
		testicles: 0,
		scrotum: 0,
		pigTesticles: 0,
		dogTesticles: 0,
		horseTesticles: 0,
		cowTesticles: 0,
		foreskin: 0,
		ovaries: 0,
		freshOvaries: 0,
		prostate: 0,
		pigOvaries: 0,
		dogOvaries: 0,
		horseOvaries: 0,
		cowOvaries: 0,
		eyes: 0,
		cochleae: 0,
		voicebox: 0,
		mpreg: 0,
		mpregPig: 0,
		mpregDog: 0,
		mpregHorse: 0,
		mpregCow: 0
		}>>
	<<for _j = 0; _j < $completedOrgans.length; _j++>>
		<<if $activeSlave.ID == $completedOrgans[_j].ID>>
			<<if $completedOrgans[_j].type == "penis">>
				<<set _slaveOrgans.penis = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "testicles">>
				<<set _slaveOrgans.testicles = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "scrotum">>
				<<set _slaveOrgans.scrotum = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "pigTesticles">>
				<<set _slaveOrgans.pigTesticles = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "dogTesticles">>
				<<set _slaveOrgans.dogTesticles = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "horseTesticles">>
				<<set _slaveOrgans.horseTesticles = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "cowTesticles">>
				<<set _slaveOrgans.cowTesticles = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "foreskin">>
				<<set _slaveOrgans.foreskin = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "ovaries">>
				<<set _slaveOrgans.ovaries = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "freshOvaries">>
				<<set _slaveOrgans.freshOvaries = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "prostate">>
				<<set _slaveOrgans.prostate = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "pigOvaries">>
				<<set _slaveOrgans.pigOvaries = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "dogOvaries">>
				<<set _slaveOrgans.dogOvaries = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "horseOvaries">>
				<<set _slaveOrgans.horseOvaries = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "cowOvaries">>
				<<set _slaveOrgans.cowOvaries = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "eyes">>
				<<set _slaveOrgans.eyes = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "cochleae">>
				<<set _slaveOrgans.cochleae = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "voicebox">>
				<<set _slaveOrgans.voicebox = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "mpreg">>
				<<set _slaveOrgans.mpreg = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "mpregPig">>
				<<set _slaveOrgans.mpregPig = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "mpregDog">>
				<<set _slaveOrgans.mpregDog = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "mpregHorse">>
				<<set _slaveOrgans.mpregHorse = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<elseif $completedOrgans[_j].type == "mpregCow">>
				<<set _slaveOrgans.mpregCow = $completedOrgans[_j]>>
				<<set $completedOrgans.deleteAt(_j),_j-->>
			<<else>>
				<br>Error: unrecognized organ.
			<</if>>
		<</if>>
	<</for>>
	/* read _slaveOrgans and install them when appropriate */
	/* order here is important, do not change it without good reason */
	/* eyes */
	<<if _slaveOrgans.eyes != 0>>
		<<if ($activeSlave.eyes == -2) && $activeSlave.origEye != "implant">>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.eyes = 1>>
			<<set $activeSlave.eyeColor = $activeSlave.origEye>>
			/* no way to salvage original eye color */
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<set $surgeryType = "unblind">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.origEye == "implant">>
			<<set $cash -= $surgeryCost>>
			<<set $stockpile.ocularImplant++>>
			<<set $activeSlave.eyes = 1>>
			<<set _oldEyes = $genePool.find(function(s) { return s.ID = $activeSlave.ID; })>>
			<<set $activeSlave.origEye = _oldEyes.origEye>>
			<<set $activeSlave.eyeColor = $activeSlave.origEye>>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<set $surgeryType = "newEyes">>
			<<include "Surgery Degradation">>
		<<else>>
			<br><hr>
			@@.red;Could not implant eyes on $activeSlave.slaveName: she is not blind.@@
			<<set $completedOrgans.push(_slaveOrgans.eyes)>>
		<</if>>
	<</if>>
	/* cochleae */
	<<if _slaveOrgans.cochleae != 0>>
		<<if ($activeSlave.hears == -2) && $activeSlave.earImplant != 1>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.hears = 0>>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<set $surgeryType = "undeafen">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.earImplant == 1>>
			<<set $cash -= $surgeryCost>>
			<<set $stockpile.cochlearImplant++>>
			<<set $activeSlave.hears = 0>>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<set $surgeryType = "newEars">>
			<<include "Surgery Degradation">>
		<<else>>
			<br><hr>
			@@.red;Could not implant cochleae on $activeSlave.slaveName: she is not deaf.@@
			<<set $completedOrgans.push(_slaveOrgans.cochleae)>>
		<</if>>
	<</if>>
	/* voice */
	<<if _slaveOrgans.voicebox != 0>>
		<<if ($activeSlave.voice == 0)>>
			<<set $cash -= $surgeryCost>>
			<<if $activeSlave.ovaries == 1 && $activeSlave.hormoneBalance >= 200>>
				<<set $activeSlave.voice = 3>>
			<<elseif ($activeSlave.balls > 0) || ($activeSlave.hormoneBalance < -20)>>
				<<set $activeSlave.voice = 1>>
			<<else>>
				<<set $activeSlave.voice = 2>>
			<</if>>
			<<set $activeSlave.health -= 10>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 10>>
			<</if>>
			<<set $surgeryType = "restoreVoice">>
			<br><hr>
			<<run Enunciate($activeSlave)>>
			<<include "Surgery Degradation">>
		<<else>>
			<br><hr>
			@@.red;Could not implant vocal cords on $activeSlave.slaveName: she is not mute.@@
			<<set $completedOrgans.push(_slaveOrgans.voicebox)>>
		<</if>>
	<</if>>
	/* foreskin */
	<<if _slaveOrgans.foreskin != 0>>
		<<if ($activeSlave.foreskin == 0)>>
			<<set $cash -= $surgeryCost>>
			<<if $activeSlave.dick > 0>>
				<<set $activeSlave.foreskin = $activeSlave.dick>>
			<<else>>
				<<set $activeSlave.foreskin = $activeSlave.clit>>
			<</if>>
			<<set $activeSlave.health -= 10>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 10>>
			<</if>>
			<<set $surgeryType = "addForeskin">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<else>>
			<br><hr>
			@@.red;Could not implant <<if $activeSlave.dick > 0>>foreskin<<else>>clitoral hood<</if>> on $activeSlave.slaveName: she already has one.@@
			<<set $completedOrgans.push(_slaveOrgans.foreskin)>>
		<</if>>
	<</if>>
	/* prostate */
	<<if _slaveOrgans.prostate != 0>>
		<<if ($activeSlave.prostate == 0)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.prostate = 1>>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<set $surgeryType = "addProstate">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<else>>
			<br><hr>
			@@.red;Could not implant prostate on $activeSlave.slaveName: she already has a prostate.@@
			<<set $completedOrgans.push(_slaveOrgans.prostate)>>
		<</if>>
	<</if>>
	/* ovaries */
	<<if _slaveOrgans.ovaries != 0>>
		<<if ($activeSlave.ovaries == 0) && ($activeSlave.vagina >= 0) && ($activeSlave.mpreg == 0) && ($activeSlave.bellyImplant == -1)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.ovaries = 1>>
			<<set $activeSlave.eggType = "human">>
			<<set $activeSlave.preg = 0>>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXX == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyAgeXX = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyXX = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "addOvaries">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.ovaries == 1>>
			<br><hr>
			@@.red;Could not implant ovaries on $activeSlave.slaveName: she already has ovaries.@@
			<<set $completedOrgans.push(_slaveOrgans.ovaries)>>
		<<elseif $activeSlave.vagina < 0>>
			<br><hr>
			@@.red;Could not implant ovaries on $activeSlave.slaveName: she lacks a vagina.@@
			<<set $completedOrgans.push(_slaveOrgans.ovaries)>>
		<<elseif $activeSlave.bellyImplant >= 0>>
			<br><hr>
			@@.red;Could not implant ovaries on $activeSlave.slaveName: she has a fillable abdominal implant.@@
			<<set $completedOrgans.push(_slaveOrgans.ovaries)>>
		<<elseif $activeSlave.mpreg != 0>>
			<br><hr>
			@@.red;Could not implant ovaries on $activeSlave.slaveName: she has an anal womb.@@
			<<set $completedOrgans.push(_slaveOrgans.ovaries)>>
		<</if>>
	<</if>>
	/* pig ovaries */
	<<if _slaveOrgans.pigOvaries != 0>>
		<<if ($activeSlave.ovaries == 0) && ($activeSlave.vagina >= 0) && ($activeSlave.mpreg == 0) && ($activeSlave.bellyImplant == -1)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.ovaries = 1>>
			<<set $activeSlave.eggType = "pig">>
			<<set $activeSlave.preg = 0>>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXX == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyAgeXX = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyXX = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "addPigOvaries">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.ovaries == 1>>
			<br><hr>
			@@.red;Could not implant pig ovaries on $activeSlave.slaveName: she already has ovaries.@@
			<<set $completedOrgans.push(_slaveOrgans.pigOvaries)>>
		<<elseif $activeSlave.vagina < 0>>
			<br><hr>
			@@.red;Could not implant pig ovaries on $activeSlave.slaveName: she lacks a vagina.@@
			<<set $completedOrgans.push(_slaveOrgans.pigOvaries)>>
		<<elseif $activeSlave.bellyImplant >= 0>>
			<br><hr>
			@@.red;Could not implant pig ovaries on $activeSlave.slaveName: she has a fillable abdominal implant.@@
			<<set $completedOrgans.push(_slaveOrgans.pigOvaries)>>
		<<elseif $activeSlave.mpreg != 0>>
			<br><hr>
			@@.red;Could not implant pig ovaries on $activeSlave.slaveName: she has an anal womb.@@
			<<set $completedOrgans.push(_slaveOrgans.pigOvaries)>>
		<</if>>
	<</if>>
	/* dog ovaries */
	<<if _slaveOrgans.dogOvaries != 0>>
		<<if ($activeSlave.ovaries == 0) && ($activeSlave.vagina >= 0) && ($activeSlave.mpreg == 0) && ($activeSlave.bellyImplant == -1)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.ovaries = 1>>
			<<set $activeSlave.eggType = "dog">>
			<<set $activeSlave.preg = 0>>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXX == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyAgeXX = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyXX = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "addDogOvaries">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.ovaries == 1>>
			<br><hr>
			@@.red;Could not implant dog ovaries on $activeSlave.slaveName: she already has ovaries.@@
			<<set $completedOrgans.push(_slaveOrgans.dogOvaries)>>
		<<elseif $activeSlave.vagina < 0>>
			<br><hr>
			@@.red;Could not implant dog ovaries on $activeSlave.slaveName: she lacks a vagina.@@
			<<set $completedOrgans.push(_slaveOrgans.dogOvaries)>>
		<<elseif $activeSlave.bellyImplant >= 0>>
			<br><hr>
			@@.red;Could not implant dog ovaries on $activeSlave.slaveName: she has a fillable abdominal implant.@@
			<<set $completedOrgans.push(_slaveOrgans.dogOvaries)>>
		<<elseif $activeSlave.mpreg != 0>>
			<br><hr>
			@@.red;Could not implant dog ovaries on $activeSlave.slaveName: she has an anal womb.@@
			<<set $completedOrgans.push(_slaveOrgans.dogOvaries)>>
		<</if>>
	<</if>>
	/* horse ovaries */
	<<if _slaveOrgans.horseOvaries != 0>>
		<<if ($activeSlave.ovaries == 0) && ($activeSlave.vagina >= 0) && ($activeSlave.mpreg == 0) && ($activeSlave.bellyImplant == -1)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.ovaries = 1>>
			<<set $activeSlave.eggType = "horse">>
			<<set $activeSlave.preg = 0>>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXX == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyAgeXX = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyXX = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "addHorseOvaries">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.ovaries == 1>>
			<br><hr>
			@@.red;Could not implant horse ovaries on $activeSlave.slaveName: she already has ovaries.@@
			<<set $completedOrgans.push(_slaveOrgans.horseOvaries)>>
		<<elseif $activeSlave.vagina < 0>>
			<br><hr>
			@@.red;Could not implant horse ovaries on $activeSlave.slaveName: she lacks a vagina.@@
			<<set $completedOrgans.push(_slaveOrgans.horseOvaries)>>
		<<elseif $activeSlave.bellyImplant >= 0>>
			<br><hr>
			@@.red;Could not implant horse ovaries on $activeSlave.slaveName: she has a fillable abdominal implant.@@
			<<set $completedOrgans.push(_slaveOrgans.horseOvaries)>>
		<<elseif $activeSlave.mpreg != 0>>
			<br><hr>
			@@.red;Could not implant horse ovaries on $activeSlave.slaveName: she has an anal womb.@@
			<<set $completedOrgans.push(_slaveOrgans.horseOvaries)>>
		<</if>>
	<</if>>
	/* cow ovaries */
	<<if _slaveOrgans.cowOvaries != 0>>
		<<if ($activeSlave.ovaries == 0) && ($activeSlave.vagina >= 0) && ($activeSlave.mpreg == 0) && ($activeSlave.bellyImplant == -1)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.ovaries = 1>>
			<<set $activeSlave.eggType = "cow">>
			<<set $activeSlave.preg = 0>>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXX == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyAgeXX = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyXX = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "addCowOvaries">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.ovaries == 1>>
			<br><hr>
			@@.red;Could not implant cow ovaries on $activeSlave.slaveName: she already has ovaries.@@
			<<set $completedOrgans.push(_slaveOrgans.cowOvaries)>>
		<<elseif $activeSlave.vagina < 0>>
			<br><hr>
			@@.red;Could not implant cow ovaries on $activeSlave.slaveName: she lacks a vagina.@@
			<<set $completedOrgans.push(_slaveOrgans.cowOvaries)>>
		<<elseif $activeSlave.bellyImplant >= 0>>
			<br><hr>
			@@.red;Could not implant cow ovaries on $activeSlave.slaveName: she has a fillable abdominal implant.@@
			<<set $completedOrgans.push(_slaveOrgans.cowOvaries)>>
		<<elseif $activeSlave.mpreg != 0>>
			<br><hr>
			@@.red;Could not implant cow ovaries on $activeSlave.slaveName: she has an anal womb.@@
			<<set $completedOrgans.push(_slaveOrgans.cowOvaries)>>
		<</if>>
	<</if>>
	/* male preg */
	<<if _slaveOrgans.mpreg != 0>>
		<<if ($activeSlave.ovaries == 0) && ($activeSlave.vagina < 0) && ($activeSlave.mpreg == 0) && ($activeSlave.bellyImplant == -1)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.mpreg = 1>>
			<<set $activeSlave.eggType = "human">>
			<<set $activeSlave.preg = 0>>
			<<set $activeSlave.health -= 40>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXX == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyAgeXX = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyXX = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "mpreg">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.ovaries == 1>>
			<br><hr>
			@@.red;Could not implant anal womb on $activeSlave.slaveName: she has ovaries.@@
			<<set $completedOrgans.push(_slaveOrgans.mpreg)>>
		<<elseif $activeSlave.vagina < 0>>
			<br><hr>
			@@.red;Could not implant anal womb on $activeSlave.slaveName: she has a vagina.@@
			<<set $completedOrgans.push(_slaveOrgans.mpreg)>>
		<<elseif $activeSlave.bellyImplant >= 0>>
			<br><hr>
			@@.red;Could not implant anal womb on $activeSlave.slaveName: she has a fillable abdominal implant.@@
			<<set $completedOrgans.push(_slaveOrgans.mpreg)>>
		<<elseif $activeSlave.mpreg == 1>>
			<br><hr>
			@@.red;Could not implant anal womb on $activeSlave.slaveName: she already has an anal womb.@@
			<<set $completedOrgans.push(_slaveOrgans.mpreg)>>
		<</if>>
	<</if>>
	/* male pig preg */
	<<if _slaveOrgans.mpregPig != 0>>
		<<if ($activeSlave.ovaries == 0) && ($activeSlave.vagina < 0) && ($activeSlave.mpreg == 0) && ($activeSlave.bellyImplant == -1)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.mpreg = 1>>
			<<set $activeSlave.eggType = "pig">>
			<<set $activeSlave.preg = 0>>
			<<set $activeSlave.health -= 40>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXX == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyAgeXX = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyXX = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "mpregPig">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.ovaries == 1>>
			<br><hr>
			@@.red;Could not implant pig anal womb on $activeSlave.slaveName: she has ovaries.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregPig)>>
		<<elseif $activeSlave.vagina < 0>>
			<br><hr>
			@@.red;Could not implant pig anal womb on $activeSlave.slaveName: she has a vagina.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregPig)>>
		<<elseif $activeSlave.bellyImplant >= 0>>
			<br><hr>
			@@.red;Could not implant pig anal womb on $activeSlave.slaveName: she has a fillable abdominal implant.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregPig)>>
		<<elseif $activeSlave.mpreg != 0>>
			<br><hr>
			@@.red;Could not implant pig anal womb on $activeSlave.slaveName: she already has an anal womb.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregPig)>>
		<</if>>
	<</if>>
	/* male dog preg */
	<<if _slaveOrgans.mpregDog != 0>>
		<<if ($activeSlave.ovaries == 0) && ($activeSlave.vagina < 0) && ($activeSlave.mpreg == 0) && ($activeSlave.bellyImplant == -1)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.mpreg = 1>>
			<<set $activeSlave.eggType = "dog">>
			<<set $activeSlave.preg = 0>>
			<<set $activeSlave.health -= 40>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXX == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyAgeXX = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyXX = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "mpregDog">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.ovaries == 1>>
			<br><hr>
			@@.red;Could not implant dog anal womb on $activeSlave.slaveName: she has ovaries.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregDog)>>
		<<elseif $activeSlave.vagina < 0>>
			<br><hr>
			@@.red;Could not implant dog anal womb on $activeSlave.slaveName: she has a vagina.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregDog)>>
		<<elseif $activeSlave.bellyImplant >= 0>>
			<br><hr>
			@@.red;Could not implant dog anal womb on $activeSlave.slaveName: she has a fillable abdominal implant.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregDog)>>
		<<elseif $activeSlave.mpreg != 0>>
			<br><hr>
			@@.red;Could not implant dog anal womb on $activeSlave.slaveName: she already has an anal womb.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregDog)>>
		<</if>>
	<</if>>
	/* male horse preg */
	<<if _slaveOrgans.mpregHorse != 0>>
		<<if ($activeSlave.ovaries == 0) && ($activeSlave.vagina < 0) && ($activeSlave.mpreg == 0) && ($activeSlave.bellyImplant == -1)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.mpreg = 1>>
			<<set $activeSlave.eggType = "horse">>
			<<set $activeSlave.preg = 0>>
			<<set $activeSlave.health -= 40>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXX == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyAgeXX = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyXX = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "mpregHorse">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.ovaries == 1>>
			<br><hr>
			@@.red;Could not implant horse anal womb on $activeSlave.slaveName: she has ovaries.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregHorse)>>
		<<elseif $activeSlave.vagina < 0>>
			<br><hr>
			@@.red;Could not implant horse anal womb on $activeSlave.slaveName: she has a vagina.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregHorse)>>
		<<elseif $activeSlave.bellyImplant >= 0>>
			<br><hr>
			@@.red;Could not implant horse anal womb on $activeSlave.slaveName: she has a fillable abdominal implant.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregHorse)>>
		<<elseif $activeSlave.mpreg != 0>>
			<br><hr>
			@@.red;Could not implant horse anal womb on $activeSlave.slaveName: she already has an anal womb.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregHorse)>>
		<</if>>
	<</if>>
	/* male cow preg */
	<<if _slaveOrgans.mpregCow != 0>>
		<<if ($activeSlave.ovaries == 0) && ($activeSlave.vagina < 0) && ($activeSlave.mpreg == 0) && ($activeSlave.bellyImplant == -1)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.mpreg = 1>>
			<<set $activeSlave.eggType = "cow">>
			<<set $activeSlave.preg = 0>>
			<<set $activeSlave.health -= 40>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXX == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyAgeXX = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyXX = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "mpregCow">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.ovaries == 1>>
			<br><hr>
			@@.red;Could not implant cow anal womb on $activeSlave.slaveName: she has ovaries.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregCow)>>
		<<elseif $activeSlave.vagina < 0>>
			<br><hr>
			@@.red;Could not implant cow anal womb on $activeSlave.slaveName: she has a vagina.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregCow)>>
		<<elseif $activeSlave.bellyImplant >= 0>>
			<br><hr>
			@@.red;Could not implant cow anal womb on $activeSlave.slaveName: she has a fillable abdominal implant.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregCow)>>
		<<elseif $activeSlave.mpreg != 0>>
			<br><hr>
			@@.red;Could not implant cow anal womb on $activeSlave.slaveName: she already has an anal womb.@@
			<<set $completedOrgans.push(_slaveOrgans.mpregCow)>>
		<</if>>
	<</if>>
	/* ovary renewal */
	<<if _slaveOrgans.freshOvaries != 0>>
		<<if (($activeSlave.ovaries == 1) || ($activeSlave.mpreg == 1)) && ($activeSlave.bellyImplant == -1) && ($activeSlave.physicalAge < 60)>>
			<<set $cash -= $surgeryCost>>
			<<if $activeSlave.ovaryAge >= 47>>
				<<set $activeSlave.ovaryAge = 45>>
			<<else>>
				<<set $activeSlave.ovaryAge -= 2>> /* It shouldn't matter if this goes negative as it is just a signal for menopause to occur. */
			<</if>>
			<<if $activeSlave.preg < 0>>
				<<set $activeSlave.preg = 0>>
			<</if>>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXX == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyAgeXX = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $fertilityAge>>
						<<set $activeSlave.pubertyXX = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "freshOvaries">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif ($activeSlave.physicalAge >= 60)>>
			<br><hr>
			@@.red;This slave's body is too old to handle pregnancy.@@
		<<elseif ($activeSlave.mpreg == 0 && $activeSlave.ovaries == 0) || $activeSlave.bellyImplant != -1>>
			<br><hr>
			@@.red;This slave lacks a viable womb to accept fertile ovaries.@@
			<<set $completedOrgans.push(_slaveOrgans.freshOvaries)>>
		<</if>>
	<</if>>
	/* penis */
	<<if _slaveOrgans.penis != 0>>
		<<if $activeSlave.dick == 0>>
			<<set $cash -= $surgeryCost>>
			<<if $activeSlave.prostate == 0>>
				<<set $activeSlave.prostate = 1>>
			<</if>>
			<<set $activeSlave.dick = 2>>
			<<set $activeSlave.clit = 0>>
			<<set $activeSlave.foreskin = $activeSlave.dick>>
			<<set $activeSlave.health -= 20>>
			<<set $surgeryType = "addDick">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<else>>
			@@.red;Could not implant penis on $activeSlave.slaveName: she already has a penis.@@
			<<set $completedOrgans.push(_slaveOrgans.penis)>>
		<</if>>
	<</if>>
	/* testicles */
	<<if _slaveOrgans.testicles != 0>>
		<<if ($activeSlave.dick >= 1) && ($activeSlave.balls == 0)>>
			<<set $cash -= $surgeryCost>>
			<<if $activeSlave.prostate == 0>>
				<<set $activeSlave.prostate = 1>>
			<</if>>
			<<set $activeSlave.balls = 2>>
			<<set $activeSlave.ballType = "human">>
			<<set $activeSlave.scrotum = 2>>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXY == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $potencyAge>>
						<<set $activeSlave.pubertyAgeXY = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $potencyAge>>
						<<set $activeSlave.pubertyXY = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "addBalls">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.dick == 0>>
			<br><hr>
			@@.red;Could not implant testicles on $activeSlave.slaveName: she lacks a penis.@@
			<<set $completedOrgans.push(_slaveOrgans.testicles)>>
		<<else>>
			<br><hr>
			@@.red;Could not implant testicles on $activeSlave.slaveName: she already has testicles.@@
			<<set $completedOrgans.push(_slaveOrgans.testicles)>>
		<</if>>
	<</if>>
	/* pig testicles */
	<<if _slaveOrgans.pigTesticles != 0>>
		<<if ($activeSlave.dick >= 1) && ($activeSlave.balls == 0)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.balls = 3>>
			<<set $activeSlave.scrotum = 3>>
			<<set $activeSlave.ballType = "pig">>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXY == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $potencyAge>>
						<<set $activeSlave.pubertyAgeXY = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $potencyAge>>
						<<set $activeSlave.pubertyXY = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "addPigBalls">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.dick == 0>>
			<br><hr>
			@@.red;Could not implant pig testicles on $activeSlave.slaveName: she lacks a penis.@@
			<<set $completedOrgans.push(_slaveOrgans.pigTesticles)>>
		<<else>>
			<br><hr>
			@@.red;Could not implant pig testicles on $activeSlave.slaveName: she already has testicles.@@
			<<set $completedOrgans.push(_slaveOrgans.pigTesticles)>>
		<</if>>
	<</if>>
	/* dog testicles */
	<<if _slaveOrgans.dogTesticles != 0>>
		<<if ($activeSlave.dick >= 0) && ($activeSlave.balls == 0)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.balls = 2>>
			<<set $activeSlave.ballType = "dog">>
			<<set $activeSlave.scrotum = 2>>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXY == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $potencyAge>>
						<<set $activeSlave.pubertyAgeXY = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $potencyAge>>
						<<set $activeSlave.pubertyXY = 1>>
					<</if>>
				<</if>>
			<</if>>
			<br><hr>
			<<set $surgeryType = "addDogBalls">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.dick == 0>>
			<br><hr>
			@@.red;Could not implant dog testicles on $activeSlave.slaveName: she lacks a penis.@@
			<<set $completedOrgans.push(_slaveOrgans.dogTesticles)>>
		<<else>>
			<br><hr>
			@@.red;Could not implant dog testicles on $activeSlave.slaveName: she already has testicles.@@
			<<set $completedOrgans.push(_slaveOrgans.dogTesticles)>>
		<</if>>
	<</if>>
	/* horse testicles */
	<<if _slaveOrgans.horseTesticles != 0>>
		<<if ($activeSlave.dick >= 1) && ($activeSlave.balls == 0)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.balls = 3>>
			<<set $activeSlave.scrotum = 3>>
			<<set $activeSlave.ballType = "horse">>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXY == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $potencyAge>>
						<<set $activeSlave.pubertyAgeXY = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $potencyAge>>
						<<set $activeSlave.pubertyXY = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "addHorseBalls">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.dick == 0>>
			<br><hr>
			@@.red;Could not implant horse testicles on $activeSlave.slaveName: she lacks a penis.@@
			<<set $completedOrgans.push(_slaveOrgans.horseTesticles)>>
		<<else>>
			<br><hr>
			@@.red;Could not implant horse testicles on $activeSlave.slaveName: she already has testicles.@@
			<<set $completedOrgans.push(_slaveOrgans.horseTesticles)>>
		<</if>>
	<</if>>
	/* cow testicles */
	<<if _slaveOrgans.cowTesticles != 0>>
		<<if ($activeSlave.dick >= 1) && ($activeSlave.balls == 0)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.balls = 3>>
			<<set $activeSlave.scrotum = 3>>
			<<set $activeSlave.ballType = "cow">>
			<<set $activeSlave.health -= 20>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 20>>
			<</if>>
			<<if $activeSlave.pubertyXY == 0>>
				<<if $precociousPuberty == 1>>
					<<if $activeSlave.physicalAge >= $potencyAge>>
						<<set $activeSlave.pubertyAgeXY = ($activeSlave.physicalAge+1)>>
					<</if>>
				<<else>>
					<<if $activeSlave.physicalAge >= $potencyAge>>
						<<set $activeSlave.pubertyXY = 1>>
					<</if>>
				<</if>>
			<</if>>
			<<set $surgeryType = "addCowBalls">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.dick == 0>>
			<br><hr>
			@@.red;Could not implant cow testicles on $activeSlave.slaveName: she lacks a penis.@@
			<<set $completedOrgans.push(_slaveOrgans.cowTesticles)>>
		<<else>>
			<br><hr>
			@@.red;Could not implant cow testicles on $activeSlave.slaveName: she already has testicles.@@
			<<set $completedOrgans.push(_slaveOrgans.cowTesticles)>>
		<</if>>
	<</if>>
	/* scrotum */
	<<if _slaveOrgans.scrotum != 0>>
		<<if ($activeSlave.scrotum == 0) && ($activeSlave.balls >= 1)>>
			<<set $cash -= $surgeryCost>>
			<<set $activeSlave.scrotum = $activeSlave.balls>>
			<<set $activeSlave.health -= 10>>
			<<if $organFarmUpgrade == 2>>
				<<set $activeSlave.chem += 10>>
			<</if>>
			<<set $surgeryType = "addScrotum">>
			<br><hr>
			<<include "Surgery Degradation">>
		<<elseif $activeSlave.balls == 0>>
			<br><hr>
			@@.red;Could not implant scrotum on $activeSlave.slaveName: she lacks testicles.@@
			<<set $completedOrgans.push(_slaveOrgans.scrotum)>>
		<<else>>
			<br><hr>
			@@.red;Could not implant scrotum on $activeSlave.slaveName: she already has a scrotum.@@
			<<set $completedOrgans.push(_slaveOrgans.scrotum)>>
		<</if>>
	<</if>>
	/* finished checking _slaveOrgans */
	/* limbs */
	<<if $activeSlave.amp != 0>>
		<<for _l = 0; _l < $limbs.length; _l++>>
			<<if ($limbs[_l].ID == $activeSlave.ID) && ($limbs[_l].weeksToCompletion <= 0)>>
				<<if $activeSlave.PLimb != 0>>
					<<if $activeSlave.amp < 0>>
						<<set _oldLimbs = {type: 0, armsTat: 0, legsTat: 0}>>
						<<set _oldLimbs.type = $activeSlave.amp, _oldLimbs.armsTat = $activeSlave.armsTat, _oldLimbs.legsTat = $activeSlave.legsTat>>
						<<set $activeSlave.readyLimbs.push(_oldLimbs)>>
					<</if>>

					<<switch $limbs[_l].type>>
					<<case "simple">>
						<<set $activeSlave.amp = -1>>
						<<set $surgeryType = "basicPLimbs">>
					<<case "sex">>
						<<set $activeSlave.amp = -2>>
						<<set $surgeryType = "sexPLimbs">>
					<<case "beauty">>
						<<set $activeSlave.amp = -3>>
						<<set $surgeryType = "beautyPLimbs">>
					<<case "combat">>
						<<set $activeSlave.amp = -4>>
						<<set $surgeryType = "combatPLimbs">>
					<<case "cyber">>
						<<set $activeSlave.amp = -5>>
						<<set $surgeryType = "cyberPLimbs">>
					<</switch>>
					<br><hr>
					<<include "Surgery Degradation">>
					<<set $limbs.deleteAt(_l)>>
					<<set $activeSlave.armsTat = 0, $activeSlave.legsTat = 0>>
				<<else>>
					<br><hr>
					@@.red;Could not install prosthetic limbs on $activeSlave.slaveName: she lacks a prosthetic interface.@@
				<</if>>
				<<break>>
			<</if>>
		<</for>>
	<</if>>
	/* updates the interrogated slave */
	<<set $slaves[_i] = $activeSlave>>
<</for>> /* end of the $slaves loop */

/* This needs to be down here to over-ride any Surgery Degradation calls */
<<set $nextButton = "Continue">>
<<set $nextLink = "Main">>

/* Clean-up */
<<set $limbsCompleted = 0>>
<<for _i = 0; _i < $limbs.length; _i++>>
	<<if $limbs[_i].weeksToCompletion <= 0>>
		<<set $limbsCompleted++>>
	<</if>>
<</for>>
