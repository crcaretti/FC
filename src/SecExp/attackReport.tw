:: attackReport [nobr]

/* result */
<<if $PCwon == 1>>
	<strong>Victory!</strong>
<<elseif $EnemyWon == 1>>
	<strong>Defeat!</strong>
<<elseif $PCpartialWon == 1>>
	<strong>Partial victory!</strong>
<<elseif $enemyPartialWon == 1>>
	<strong>Partial defeat!</strong>
<<elseif $PCsurrenders == 1>>
	<strong>We surrendered</strong>
<</if>>
<hr>
<<set $enemyLosses = Math.round($enemyLosses)>>
<<set $losses = Math.round($losses)>>

<<if $PCsurrenders != 1>>
	<<if $attackType == "raiders">>
		Today, the $day of $month, $year, our arcology was attacked by a band of wild raiders, $attackTroops men strong. Our defense forces clashed with them 
		<<if $battleTerrain == "urban">>
			in the streets of <<if $terrain == "urban">>the old world city surrounding the arcology<<else>>of the free city<</if>>,
		<<elseif $battleTerrain == "rural">>
			in the rural land surrounding the free city,
		<<elseif $battleTerrain == "hills">>
			on the hills around the free city,
		<<elseif $battleTerrain == "coast">>
			along the coast just outside the free city,
		<<elseif $battleterrain == "outskirts">>
			just against the walls of the arcology,
		<<elseif $battleTerrain == "mountains">>
			in the mountains overlooking the arcology,
		<<elseif $battleTerrain == "wasteland">>
			in the wastelands outside the free city territory,
		<</if>>
		inflicting $enemyLosses casualties, while sustaining $losses casualties themselves.
		<<if $PCwon == 1>>
			<<if $battleTurns <= 5>>
				The fight was quick and one sided, our men easily stopped the disorganized horde futile attempt at raiding your arcology. 
			<<elseif $battleTurns <= 7>>
				The fight was hard, but in the end our men stopped the disorganized horde attempt at raiding your arcology.
			<<else>>
				The fight was long and hard, but our men managed to stop the horde raiding party.
			<</if>>
		<<elseif $EnemyWon == 1>>
			<<if $battleTurns <= 5>>
				The fight was quick and one sided, our men were easily crushed by the barbaric horde of raiders.
			<<elseif $battleTurns <= 7>>
				The fight was hard and in the end the bandits proved too much to handle for our men.
			<<else>>
				The fight was long and hard, but despite their bravery the horde proved too much for our men.
			<</if>>
		<<elseif $PCpartialWon == 1>>
			The fight was long and hard, but in the end our men managed to repel the raiders, though without making any significant gain.  
		<<elseif $enemyPartialWon == 1>>
			The fight was long and hard. Our men in the end had to yield to the horde raiders, which was fortunately unable to capitalized on their victory.
		<</if>>
	<<elseif $attackType == "free city">>
		Today, the $day of $month, $year, our arcology was attacked by a contingent of mercenaries hired by a competing free city, $attackTroops men strong. Our defense forces clashed with them 
		<<if $battleTerrain == "urban">>
			in the streets of <<if $terrain == "urban">>the old world city surrounding the arcology<<else>>of the free city<</if>>,
		<<elseif $battleTerrain == "rural">>
			in the rural land surrounding the free city,
		<<elseif $battleTerrain == "hills">>
			on the hills around the free city,
		<<elseif $battleTerrain == "coast">>
			along the coast just outside the free city,
		<<elseif $battleterrain == "outskirts">>
			just against the walls of the arcology,
		<<elseif $battleTerrain == "mountains">>
			in the mountains overlooking the arcology,
		<<elseif $battleTerrain == "wasteland">>
			in the wastelands outside the free city territory,
		<</if>>
		inflicting $enemyLosses casualties, while sustaining $losses casualties themselves.
		<<if $PCwon == 1>>
			<<if $battleTurns <= 5>>
				The fight was quick and one sided, our men easily stopped the mercenaries dead in their tracks. 
			<<elseif $battleTurns <= 7>>
				The fight was hard, but in the end our men stopped the slavers attempt at weakening your arcology.
			<<else>>
				The fight was long and hard, but our men managed to stop the free city mercenaries.
			<</if>>
		<<elseif $EnemyWon == 1>>
			<<if $battleTurns <= 5>>
				The fight was quick and one sided, our men were easily crushed by the consumed mercenary veterans sent against us.
			<<elseif $battleTurns <= 7>>
				The fight was hard and in the end the slavers proved too much to handle for our men.
			<<else>>
				The fight was long and hard, but despite their bravery the mercenary slavers proved too much for our men.
			<</if>>
		<<elseif $PCpartialWon == 1>>
			The fight was long and hard, but in the end our men managed to repel the mercenaries, though without making any significant gain.  
		<<elseif $enemyPartialWon == 1>>
			The fight was long and hard. Our men in the end had to yield to the slavers, which were fortunately unable to capitalized on their victory.
		<</if>>
	<<elseif $attackType == "freedom fighters">>
		Today, the $day of $month, $year, our arcology was attacked by a group of freedom fighters bent on the destruction of the institution of slavery, $attackTroops men strong. Our defense forces clashed with them 
		<<if $battleTerrain == "urban">>
			in the streets of <<if $terrain == "urban">>the old world city surrounding the arcology<<else>>of the free city<</if>>,
		<<elseif $battleTerrain == "rural">>
			in the rural land surrounding the free city,
		<<elseif $battleTerrain == "hills">>
			on the hills around the free city,
		<<elseif $battleTerrain == "coast">>
			along the coast just outside the free city,
		<<elseif $battleterrain == "outskirts">>
			just against the walls of the arcology,
		<<elseif $battleTerrain == "mountains">>
			in the mountains overlooking the arcology,
		<<elseif $battleTerrain == "wasteland">>
			in the wastelands outside the free city territory,
		<</if>>
		inflicting $enemyLosses casualties, while sustaining $losses casualties themselves.
		<<if $PCwon == 1>>
			<<if $battleTurns <= 5>>
				The fight was quick and one sided, our men easily stopped the freedom fighters dead in their tracks. 
			<<elseif $battleTurns <= 7>>
				The fight was hard, but in the end our men stopped the fighters attempt at freeing our slaves.
			<<else>>
				The fight was long and hard, but our men managed to stop the freedom figthers.
			<</if>>
		<<elseif $EnemyWon == 1>>
			<<if $battleTurns <= 5>>
				The fight was quick and one sided, our men were easily crushed by the fanatical fury of the freedom figthers.
			<<elseif $battleTurns <= 7>>
				The fight was hard and in the end the freedom figthers proved too much to handle for our men.
			<<else>>
				The fight was long and hard, but despite their bravery the freedom figthers fury proved too much for our men.
			<</if>>
		<<elseif $PCpartialWon == 1>>
			The fight was long and hard, but in the end our men managed to repel the freedom fighters, though without making any significant gain.  
		<<elseif $enemyPartialWon == 1>>
			The fight was long and hard. Our men in the end had to yield to the freedom figthers, which were fortunately unable to capitalized on their victory.
		<</if>>
	<<elseif $attackType == "old world">>
		Today, the $day of $month, $year, our arcology was attacked by an old world nation, boasting a misplaced sense of superiority, $attackTroops men strong. Our defense forces clashed with them 
		<<if $battleTerrain == "urban">>
			in the streets of <<if $terrain == "urban">>the old world city surrounding the arcology<<else>>of the free city<</if>>,
		<<elseif $battleTerrain == "rural">>
			in the rural land surrounding the free city,
		<<elseif $battleTerrain == "hills">>
			on the hills around the free city,
		<<elseif $battleTerrain == "coast">>
			along the coast just outside the free city,
		<<elseif $battleterrain == "outskirts">>
			just against the walls of the arcology,
		<<elseif $battleTerrain == "mountains">>
			in the mountains overlooking the arcology,
		<<elseif $battleTerrain == "wasteland">>
			in the wastelands outside the free city territory,
		<</if>>
		inflicting $enemyLosses casualties, while sustaining $losses casualties themselves.
		<<if $PCwon == 1>>
			<<if $battleTurns <= 5>>
				The fight was quick and one sided, our men easily stopped the old world soldiers dead in their tracks. 
			<<elseif $battleTurns <= 7>>
				The fight was hard, but in the end our men stopped the soldiers of the old world.
			<<else>>
				The fight was long and hard, but our men managed to stop the old world soldiers.
			<</if>>
		<<elseif $EnemyWon == 1>>
			<<if $battleTurns <= 5>>
				The fight was quick and one sided, our men were easily crushed by the discipline of the old world armies.
			<<elseif $battleTurns <= 7>>
				The fight was hard and in the end the old world proved too much to handle for our men.
			<<else>>
				The fight was long and hard, but despite their bravery the determination of the old world troops proved too much for our men.
			<</if>>
		<<elseif $PCpartialWon == 1>>
			The fight was long and hard, but in the end our men managed to repel the old world soldiers, though without making any significant gain.  
		<<elseif $enemyPartialWon == 1>>
			The fight was long and hard. Our men in the end had to yield to the old world soldiers, which were fortunately unable to capitalized on their victory.
		<</if>>
	<</if>>
<<else>>
	Rather than waste lives, we chose not to resist, hoping for mercy.
<</if>>

/* calculates effects on the city */
<<if $losses > 0>>
	<<set _loss = Math.trunc($losses / $deployedUnits)>>
	<<if $deployingBots == 1>>
		<<set $secBots.troops -= _loss>>
	<<if $deployingMilitia == 1>>
		<<set _mL = $militiaUnits.length>>
		<<for _i = 0; _i < _mL; _i++>>
			<<if $militiaUnits[_i].isDeployed == 1>>
				<<set $militiaUnits[_i].troops -= (_loss - _loss * $militiaUnits[_i].medics * 0.25)>>
			<</if>>
		<</for>>
	<</if>>
	<<if $deployingSlaves == 1>>
		<<set _sL = $slaveUnits.length>>
		<<for _i = 0; _i < _sL; _i++>>
			<<if $slaveUnits[_i].isDeployed == 1>>
				<<set $slaveUnits[_i].troops -= (_loss - _loss * $slaveUnits[_i].medics * 0.25)>>
			<</if>>
		<</for>>
	<</if>>
	<<if $deployingMercs == 1>>
		<<set _meL = $mercUnits.length>>
		<<for _i = 0; _i < _meL; _i++>>
			<<if $mercUnits[_i].isDeployed == 1>>
				<<set $mercUnits[_i].troops -= (_loss - _loss * $mercUnits[_i].medics * 0.25)>>
			<</if>>
		<</for>>
	<</if>>
<</if>>




/* resets variables */
<<set $attackType = "none">>
<<set $chosenTactic = "none">>
<<set $leadingTroops = "none">>
<<set $attackTroops = 0>>
<<set $attackEquip = 0>>
<<set $deployableUnits = 0>>
<<set $deployedUnits = 0>>
<<set $deployingBots = 0>>
<<set $deployingMilitia = 0>>
<<set $deployingSlaves = 0>>
<<set $deployingMercs = 0>>
<<set $battleTerrain = "none">>
<<set $attackThisWeek = 0>>
<<set $deployableUnits = 0>>
<<set $deployedUnits = 0>>
<<set $enemyLosses = 0>>
<<set $losses = 0>>
<<set $battleTurns = 0>>
<<set $secBots.isDeployed = 0>>
<<for _i = 0; _i < _mL; _i++>>
	<<set $militiaUnits[_i].isDeployed = 0>>
<</for>>	
<<for _i = 0; _i < _sL; _i++>>
	<<set $slaveUnits[_i].isDeployed = 0>>
<</for>>	
<<for _i = 0; _i < _meL; _i++>>
	<<set $mercUnits[_i].isDeployed = 0>>
<</for>>