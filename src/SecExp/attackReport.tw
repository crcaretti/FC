:: attackReport [nobr]

/* result */
<<if $battleResult == 3>>
	<strong>Victory!</strong>
	<<set $PClossStreak = 0>>
	<<set $PCvictoryStreak += 1>>
<<elseif $battleResult == -3>>
	<strong>Defeat!</strong>
	<<set $PClossStreak += 1>>
	<<set $PCvictoryStreak = 0>>
<<elseif $battleResult == 2>>
	<strong>Partial victory!</strong>
<<elseif $battleResult == -2>>
	<strong>Partial defeat!</strong>
<<elseif $battleResult == -1>>
	<strong>We surrendered</strong>
<<elseif $battleResult == 0>>
	<strong>Failed bribery!</strong>
<<elseif $battleResult == 1>>
	<strong>Successful bribery!</strong>
<</if>>
<hr>
<<set $enemyLosses = Math.round($enemyLosses)>>
<<set $losses = Math.round($losses)>>

<<if $attackType == "raiders">>
	Today, the $day of $month, $year, our arcology was attacked by a band of wild raiders, $attackTroops men strong. Our defense forces clashed with them 
	<<if $battleTerrain == "urban">>
		in the streets of <<if $terrain == "urban">>the old world city surrounding the arcology<<else>>of the free city<</if>>,
		<<elseif $battleTerrain == "rural">>
		in the rural land surrounding the free city,
	<<elseif $battleTerrain == "hills">>
		on the hills around the free city,
	<<elseif $battleTerrain == "coast">>
		along the coast just outside the free city,
		<<elseif $battleterrain == "outskirts">>
		just against the walls of the arcology,
	<<elseif $battleTerrain == "mountains">>
		in the mountains overlooking the arcology,
	<<elseif $battleTerrain == "wasteland">>
		in the wastelands outside the free city territory,
	<</if>>
	inflicting $enemyLosses casualties, while sustaining $losses casualties themselves.
	<<if $battleResult == 3>>
		<<if $battleTurns <= 5>>
			The fight was quick and one sided, our men easily stopped the disorganized horde futile attempt at raiding your arcology
		<<elseif $battleTurns <= 7>>
			The fight was hard, but in the end our men stopped the disorganized horde attempt at raiding your arcology
		<<else>>
			The fight was long and hard, but our men managed to stop the horde raiding party
		<</if>>
		<<if $PCvictoryStreak >= 2>>
			, adding another victory to the growing list of our military's successes.
		<<elseif $PClossStreak >= 2>>
			, finally putting an end to a series of unfortunate defeats.
		<<else>>
			.
		<</if>>
	<<elseif $battleResult == -3>>
		<<if $battleTurns <= 5>>
			The fight was quick and one sided, our men were easily crushed by the barbaric horde of raiders
		<<elseif $battleTurns <= 7>>
			The fight was hard and in the end the bandits proved too much to handle for our men
		<<else>>
			The fight was long and hard, but despite their bravery the horde proved too much for our men
		<</if>>
			<<if $PCvictoryStreak >= 2>>
				, so interrupting a long series of military successes.
		<<elseif $PClossStreak >= 2>>
				, confirming the long list of recent failures our armed forces collected.
		<<else>>
			.
		<</if>>
	<<elseif $battleResult == 2>>
		The fight was long and hard, but in the end our men managed to repel the raiders, though without making any significant gain.  
	<<elseif $battleResult == -2>>
		The fight was long and hard. Our men in the end had to yield to the horde raiders, which was fortunately unable to capitalized on their victory.
	<<elseif $battleResult == -1>>
	<<elseif $battleResult == 0>>
	<<elseif 4battleResult == 1>>
	<</if>>
<<elseif $attackType == "free city">>
	Today, the $day of $month, $year, our arcology was attacked by a contingent of mercenaries hired by a competing free city, $attackTroops men strong. Our defense forces clashed with them 
	<<if $battleTerrain == "urban">>
		in the streets of <<if $terrain == "urban">>the old world city surrounding the arcology<<else>>of the free city<</if>>,
	<<elseif $battleTerrain == "rural">>
		in the rural land surrounding the free city,
	<<elseif $battleTerrain == "hills">>
		on the hills around the free city,
	<<elseif $battleTerrain == "coast">>
		along the coast just outside the free city,
	<<elseif $battleterrain == "outskirts">>
		just against the walls of the arcology,
	<<elseif $battleTerrain == "mountains">>
		in the mountains overlooking the arcology,
	<<elseif $battleTerrain == "wasteland">>
		in the wastelands outside the free city territory,
	<</if>>
	inflicting $enemyLosses casualties, while sustaining $losses casualties themselves.
	<<if $battleResult == 3>>
		<<if $battleTurns <= 5>>
			The fight was quick and one sided, our men easily stopped the mercenaries dead in their tracks
		<<elseif $battleTurns <= 7>>
			The fight was hard, but in the end our men stopped the slavers attempt at weakening your arcology
		<<else>>
			The fight was long and hard, but our men managed to stop the free city mercenaries
		<</if>>
		<<if $PCvictoryStreak >= 2>>
			, adding another victory to the growing list of our military's successes.
		<<elseif $PClossStreak >= 2>>
			, finally putting an end to a series of unfortunate defeats.
		<<else>>
			.
		<</if>>
	<<elseif $battleResult == -3>>
		<<if $battleTurns <= 5>>
				The fight was quick and one sided, our men were easily crushed by the consumed mercenary veterans sent against us
		<<elseif $battleTurns <= 7>>
			The fight was hard and in the end the slavers proved too much to handle for our men
		<<else>>
			The fight was long and hard, but despite their bravery the mercenary slavers proved too much for our men
		<</if>>
		<<if $PCvictoryStreak >= 2>>
			, so interrupting a long series of military successes.
		<<elseif $PClossStreak >= 2>>
			, confirming the long list of recent failures our armed forces collected.
		<<else>>
			.
		<</if>>
	<<elseif $battleResult == 2>>
		The fight was long and hard, but in the end our men managed to repel the mercenaries, though without making any significant gain.  
	<<elseif $battleResult == -2>>
		The fight was long and hard. Our men in the end had to yield to the slavers, which were fortunately unable to capitalized on their victory.
	<<elseif $battleResult == -1>>
	<<elseif $battleResult == 0>>
	<<elseif 4battleResult == 1>>
	<</if>>
<<elseif $attackType == "freedom fighters">>
	Today, the $day of $month, $year, our arcology was attacked by a group of freedom fighters bent on the destruction of the institution of slavery, $attackTroops men strong. Our defense forces clashed with them 
	<<if $battleTerrain == "urban">>
		in the streets of <<if $terrain == "urban">>the old world city surrounding the arcology<<else>>of the free city<</if>>,
	<<elseif $battleTerrain == "rural">>
		in the rural land surrounding the free city,
	<<elseif $battleTerrain == "hills">>
		on the hills around the free city,
	<<elseif $battleTerrain == "coast">>
		along the coast just outside the free city,
	<<elseif $battleterrain == "outskirts">>
		just against the walls of the arcology,
	<<elseif $battleTerrain == "mountains">>
		in the mountains overlooking the arcology,
	<<elseif $battleTerrain == "wasteland">>
		in the wastelands outside the free city territory,
	<</if>>
	inflicting $enemyLosses casualties, while sustaining $losses casualties themselves.
	<<if $battleResult == 3>>
		<<if $battleTurns <= 5>>
			The fight was quick and one sided, our men easily stopped the freedom fighters dead in their tracks
		<<elseif $battleTurns <= 7>>
			The fight was hard, but in the end our men stopped the fighters attack
		<<else>>
			The fight was long and hard, but our men managed to stop the freedom figthers
		<</if>>
		<<if $PCvictoryStreak >= 2>>
			, adding another victory to the growing list of our military's successes.
		<<elseif $PClossStreak >= 2>>
			, finally putting an end to a series of unfortunate defeats.
		<<else>>
			.
		<</if>>
	<<elseif $battleResult == -3>>
		<<if $battleTurns <= 5>>
			The fight was quick and one sided, our men were easily crushed by the fanatical fury of the freedom figthers
		<<elseif $battleTurns <= 7>>
			The fight was hard and in the end the freedom figthers proved too much to handle for our men
		<<else>>
			The fight was long and hard, but despite their bravery the freedom figthers fury proved too much for our men
		<</if>>
		<<if $PCvictoryStreak >= 2>>
			, so interrupting a long series of military successes.
		<<elseif $PClossStreak >= 2>>
			, confirming the long list of recent failures our armed forces collected.
		<<else>>
			.
		<</if>>
	<<elseif $battleResult == 2>>
			The fight was long and hard, but in the end our men managed to repel the freedom fighters, though without making any significant gain.  
	<<elseif $battleResult == -2>>
		The fight was long and hard. Our men in the end had to yield to the freedom figthers, which were fortunately unable to capitalized on their victory.
	<<elseif $battleResult == -1>>
	<<elseif $battleResult == 0>>
	<<elseif 4battleResult == 1>>
	<</if>>
<<elseif $attackType == "old world">>
	Today, the $day of $month, $year, our arcology was attacked by an old world nation, boasting a misplaced sense of superiority, $attackTroops men strong. Our defense forces clashed with them 
	<<if $battleTerrain == "urban">>
		in the streets of <<if $terrain == "urban">>the old world city surrounding the arcology<<else>>of the free city<</if>>,
	<<elseif $battleTerrain == "rural">>
		in the rural land surrounding the free city,
	<<elseif $battleTerrain == "hills">>
		on the hills around the free city,
	<<elseif $battleTerrain == "coast">>
		along the coast just outside the free city,
	<<elseif $battleterrain == "outskirts">>
		just against the walls of the arcology,
	<<elseif $battleTerrain == "mountains">>
		in the mountains overlooking the arcology,
	<<elseif $battleTerrain == "wasteland">>
		in the wastelands outside the free city territory,
	<</if>>
	inflicting $enemyLosses casualties, while sustaining $losses casualties themselves.
	<<if $battleResult == 3>>
		<<if $battleTurns <= 5>>
			The fight was quick and one sided, our men easily stopped the old world soldiers dead in their tracks
		<<elseif $battleTurns <= 7>>
			The fight was hard, but in the end our men stopped the soldiers of the old world
		<<else>>
			The fight was long and hard, but our men managed to stop the old world soldiers
		<</if>>
		<<if $PCvictoryStreak >= 2>>
			, adding another victory to the growing list of our military's successes.
		<<elseif $PClossStreak >= 2>>
			, finally putting an end to a series of unfortunate defeats.
		<<else>>
			.
		<</if>>
	<<elseif $battleResult == -3>>
		<<if $battleTurns <= 5>>
				The fight was quick and one sided, our men were easily crushed by the discipline of the old world armies
		<<elseif $battleTurns <= 7>>
			The fight was hard and in the end the old world proved too much to handle for our men
		<<else>>
			The fight was long and hard, but despite their bravery the determination of the old world troops proved too much for our men
		<</if>>
		<<if $PCvictoryStreak >= 2>>
			, so interrupting a long series of military successes.
		<<elseif $PClossStreak >= 2>>
			, confirming the long list of recent failures our armed forces collected.
		<<else>>
			.
		<</if>>
	<<elseif $battleResult == 2>>
		The fight was long and hard, but in the end our men managed to repel the old world soldiers, though without making any significant gain.  
	<<elseif $battleResult == -2>>
		The fight was long and hard. Our men in the end had to yield to the old world soldiers, which were fortunately unable to capitalized on their victory.
	<<elseif $battleResult == -1>>
	<<elseif $battleResult == 0>>
	<<elseif 4battleResult == 1>>
	<</if>>
<</if>>
<br>
/* calculates effects on the city */
<<if $battleResult == 3>>
	Thanks to your victory, your @@.green;reputation@@ and @@.gray;authority@@ increased. You were also able to capture
		<<if $attackType == "raiders">>
			<<set $rep += 800>>
			<<set $authority += 800>>
		<<elseif $attackType == "free city">>
			<<set $rep += 1200>>
			<<set $authority += 1200>>
		<<elseif $attackType == "freedom fighters">>
			<<set $rep += 1500>>
			<<set $authority += 1500>>
		<<elseif $attackType == "old world">>
			<<set $rep += 1200>>
			<<set $authority += 1200>>
		<</if>>
		<<if $attackTroops - $enemyLosses <= 50>>
			a small amount of attackers,
			<<set _captives = ($attackTroops - $enemyLosses) * 0.1 * random(1,3)>>
		<<elseif $attackTroops - $enemyLosses <= 100>>
			an healthy group of attackers,
			<<set _captives = ($attackTroops - $enemyLosses) * 0.1 * random(1,3)>>
		<<elseif $attackTroops - $enemyLosses <= 150>>
			a big group of attackers,
			<<set _captives = ($attackTroops - $enemyLosses) * 0.1 * random(1,3)>>
		<<elseif $attackTroops - $enemyLosses <= 200>>
			a huge group of attackers,
			<<set _captives = ($attackTroops - $enemyLosses) * 0.1 * random(1,3)>>
		<<elseif $attackTroops - $enemyLosses > 200>>
			a great amount of attackers,
			<<set _captives = ($attackTroops - $enemyLosses) * 0.1 * random(1,3)>>
		<</if>>
		and some of their equipment, which once sold produced
		<<if attackEquip == 0>>
			@@.yellowgreen;a small amount of cash.@@
			<<set $cash += 1000>>
		<<elseif $attackEquip == 1>>
			@@.yellowgreen;a moderate amount of cash.@@
			<<set $cash += 5000>>
		<<elseif $attackEquip == 2>>
			@@.yellowgreen;a good amount of cash.@@
			<<set $cash += 10000>>
		<<elseif $attackEquip == 3>>
			@@.yellowgreen;a great amount of cash.@@
			<<set $cash += 15000>>
		<<elseif $attackEquip == 4>>
			@@.yellowgreen;wealth worthy of the mightiest warlord.@@
			<<set $cash += 20000>>
		<</if>>
	@@.red;Damage to the city was virtually non-existent@@, costing only pocket cash to bring the structure back to normal. The inhabitants as well reported little to no injuries, because of this the prosperity of the arcology did not suffer.
	<<set $cash -= 1000>>
	<<if $PCvictoryStreak >= 3>>
		It seems your victories over the constant threats directed your way is having  @@.green;a positive effect on the prosperity of the arcology@@, due to the security your leadership affords.
		<<set $arcologies[0].prosperity += 5>>
	<</if>>
<<elseif $battleResult == -3>>
	Due to your defeat, your your @@.red;reputation@@ and @@.red;authority@@ decreased. Obviously your troops were not able to capture anyone or anything.
	<<if $attackType == "raiders">>
		<<set $rep -= 400>>
		<<set $authority -= 400>>
	<<elseif $attackType == "free city">>
		<<set $rep -= 600>>
		<<set $authority -= 600>>
	<<elseif $attackType == "freedom fighters">>
		<<set $rep -= 750>>
		<<set $authority -= 750>>
	<<elseif $attackType == "old world">>
		<<set $rep -= 600>>
		<<set $authority -= 600>>
	<</if>>
	In the raiding following the battle @@.red;the arcology sustained heavy damage@@, which will cost quite the amount of cash to fix. Reports of @@.red;citizens or slaves killed or missing@@ flood your office for a few days following the defeat.
	<<set $cash -= 5000>>
	<<if $week <= 30>>
		<<set $ACitizens -= random(100)>>
		<<set $ASlaves -= random(150)>>
		<<set $arcologies[0].prosperity -= random(5)>>
	<<elseif $week <= 60>>
		<<set $ACitizens -= random(120)>>
		<<set $ASlaves -= random(170)>>
		<<set $arcologies[0].prosperity -= random(10)>>
	<<elseif $week <= 90>>
		<<set $ACitizens -= random(140)>>
		<<set $ASlaves -= random(190)>>
		<<set $arcologies[0].prosperity -= random(15)>>
	<<elseif $week <= 120>>
		<<set $ACitizens -= random(160)>>
		<<set $ASlaves -= random(210)>>
		<<set $arcologies[0].prosperity -= random(20)>>
	<<else>>
		<<set $ACitizens -= random(180)>>
		<<set $ASlaves -= random(230)>>
		<<set $arcologies[0].prosperity -= random(25)>>
	<</if>>
	<<if $PClossStreak >= 3>>
		This only confirms the fears of many, @@.red;your arcology is not safe@@ and it is clear their business will be better somewhere else.
		<<set $arcologies[0].prosperity += 5>>
	<</if>>
<<elseif $battleResult == 2>>
	<strong>Partial victory!</strong>
<<elseif $battleResult == -2>>
	<strong>Partial defeat!</strong>
<<elseif $battleResult == -1>>
	<strong>We surrendered</strong>
<<elseif $battleResult == 0>>
	<strong>We surrendered</strong>
<<elseif $battleResult == 1>>
	<strong>We surrendered</strong>
<</if>>



<<if $losses > 0>>
	<<set _loss = Math.trunc($losses / $deployedUnits)>>
	<<if $deployingBots == 1>>
		<<set $secBots.troops -= _loss>>
	<</if>>
	<<if $deployingMilitia == 1>>
		<<set _mL = $militiaUnits.length>>
		<<for _i = 0; _i < _mL; _i++>>
			<<if $militiaUnits[_i].isDeployed == 1>>
				<<set $militiaUnits[_i].troops -= (_loss - _loss * $militiaUnits[_i].medics * 0.25)>>
			<</if>>
		<</for>>
	<</if>>
	<<if $deployingSlaves == 1>>
		<<set _sL = $slaveUnits.length>>
		<<for _i = 0; _i < _sL; _i++>>
			<<if $slaveUnits[_i].isDeployed == 1>>
				<<set $slaveUnits[_i].troops -= (_loss - _loss * $slaveUnits[_i].medics * 0.25)>>
			<</if>>
		<</for>>
	<</if>>
	<<if $deployingMercs == 1>>
		<<set _meL = $mercUnits.length>>
		<<for _i = 0; _i < _meL; _i++>>
			<<if $mercUnits[_i].isDeployed == 1>>
				<<set $mercUnits[_i].troops -= (_loss - _loss * $mercUnits[_i].medics * 0.25)>>
			<</if>>
		<</for>>
	<</if>>
<</if>>




/* resets variables */
<<set $attackType = "none">>
<<set $chosenTactic = "none">>
<<set $leadingTroops = "none">>
<<set $attackTroops = 0>>
<<set $attackEquip = 0>>
<<set $deployableUnits = 0>>
<<set $deployedUnits = 0>>
<<set $deployingBots = 0>>
<<set $deployingMilitia = 0>>
<<set $deployingSlaves = 0>>
<<set $deployingMercs = 0>>
<<set $battleTerrain = "none">>
<<set $attackThisWeek = 0>>
<<set $deployableUnits = 0>>
<<set $deployedUnits = 0>>
<<set $enemyLosses = 0>>
<<set $losses = 0>>
<<set $battleTurns = 0>>
<<set $secBots.isDeployed = 0>>
<<for _i = 0; _i < _mL; _i++>>
	<<set $militiaUnits[_i].isDeployed = 0>>
<</for>>	
<<for _i = 0; _i < _sL; _i++>>
	<<set $slaveUnits[_i].isDeployed = 0>>
<</for>>	
<<for _i = 0; _i < _meL; _i++>>
	<<set $mercUnits[_i].isDeployed = 0>>
<</for>>