:: rebellionEventGenerator [nobr]

/* each week each possible rebellion will roll for events. If one happens (only one each week in total) the player may interact with it and the counter for the rebellion may go up or stay the same */

<<set _slave = 0>>
<<set _citizen = 0>>
<<set _CSratio = $ACitizens / $ASlaves>>

/* slaves */
<<if $authority <= 3000>>
	<<set _slave += 30>>
<<elseif $authority <= 6000>>
	<<set _slave += 25>>
<<elseif $authority <= 9000>>
	<<set _slave += 20>>
<<elseif $authority <= 12000>>
	<<set _slave += 15>>
<<elseif $authority <= 15000>>
	<<set _slave += 10>>
<<elseif $authority <= 18000>>
	<<set _slave += 5>>
<</if>>
<<if _CSratio <= 0.2>>
	<<set _slave += 30>>
<<elseif _CSratio <= 0.4>>
	<<set _slave += 25>>
<<elseif _CSratio <= 0.6>>
	<<set _slave += 20>>
<<elseif _CSratio <= 0.8>>
	<<set _slave += 15>>
<<elseif _CSratio <= 1>>
	<<set _slave += 10>>
<<elseif _CSratio >= 1.2>>
	<<set _slave -= 5>>
<</if>>
<<if $security <= 10>>
	<<set _slave += 30>>
<<elseif $security <= 30>>
	<<set _slave += 20>>
<<elseif $security <= 60>>
	<<set _slave += 10>>
<<elseif $security >= 90>>
	<<set _slave -= 5>>
<</if>>
<<if $arcologies[0].FSDegradationist != "unset">>
	<<set _slave += 30>>
<<elseif $arcologies[0].FSPaternalist != "unset">>
	<<set _slave -= 5>>
<<else>>
	<<set _slave += 5>>
<</if>>
<<if $arcologies[0].FSRestart != "unset">>
	<<set _slave += 30>>
<<elseif $arcologies[0].FSRepopulationFocus != "unset">>
	<<set _slave -= 5>>
<<else>>
	<<set _slave += 5>>
<</if>>
	
/* citizens */
<<if $authority <= 3000>>
	<<set _citizen += 30>>
<<elseif $authority <= 6000>>
	<<set _citizen += 25>>
<<elseif $authority <= 9000>>
	<<set _citizen += 20>>
<<elseif $authority <= 12000>>
	<<set _citizen += 15>>
<<elseif $authority <= 15000>>
	<<set _citizen += 10>>
<<elseif $authority <= 18000>>
	<<set _citizen += 5>>
<</if>>
<<if $crime >= 90>>
	<<set _citizen += 30>>
<<elseif $crime >= 60>>
	<<set _citizen += 15>>
<<elseif $crime >= 30>>
	<<set _citizen += 5>>
<<else>>
	<<set _citizen -= 5>>
<</if>>
<<if $militiaFounded == 1>>
	<<if ($arcologies[0].FSRomanRevivalist == "unset" && $arcologies[0].FSAztecRevivalist == "unset" && $arcologies[0].FSEgyptianRevivalist == "unset" &&
	$arcologies[0].FSEdoRevivalist == "unset" && $arcologies[0].FSArabianRevivalist == "unset" && $arcologies[0].FSChineseRevivalist == "unset")>>
		<<if $militarizedSociety == 1>>
			<<set _citizen += 20>>
		<<elseif $militaryService == 1>>
			<<set _citizen += 15>>
		<<else>>
			<<set _citizen += 10>>
		<</if>>
	<<else>>
		<<if $militarizedSociety == 1>>
			<<set _citizen += 10>>
		<<elseif $militaryService == 1>>
			<<set _citizen += 5>>
		<<else>>
			<<set _citizen -= 5>>
		<</if>>
	<</if>>	
<</if>>
<<if $arcologies[0].FSNull != "unset">>
	<<set _citizen += either(20,30)>>
<</if>
<<if $arcologies[0].FSRestart != "unset">>
	<<if _CSratio > 1>>
		<<set _citizen +=20>>
	<<elseif _CSratio > 0.5>>
		<<set _citizen += 15>>
	<<elseif _CSratio < 0.2>>
		<<set _citizen -= 5>>
	<</if>>
<<elseif $arcologies[0].FSRepopulationFocus != "unset">>
	<<if _CSratio < 0.5>>
		<<set _citizen +=20>>
	<<elseif _CSratio < 1>>
		<<set _citizen += 15>>
	<<elseif _CSratio > 1.4>>
		<<set _citizen += 5>>
	<</if>>
<</if>>

/* rolls to see if event happens */
<<if _slave > _citizen>>
	<<if _slave > 100>>
		<<set _slave = random(90,95)>> 				/* there's always a small chance nothing happens */
	<</if>>
	<<if random(1,100) < _slave>>
		<<set $slaveRebellionEventFires = 1>>
		<<set $citizenRebellionEventFires = 0>>
	<</if>>
<<else>>
	<<if _citizen > 100>>
		<<set _citizen = random(90,95)>>
	<</if>>
	<<if random(1,100) < _citizen>>
		<<set $slaveRebellionEventFires = 0>>
		<<set $citizenRebellionEventFires = 1>>
	<</if>>
<</if>>