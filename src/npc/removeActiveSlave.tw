:: Remove activeSlave [nobr silently]

<<set _ID = $activeSlave.ID, _SL = $slaves.length, _x = $slaveIndices[_ID]>>

<<set WombZeroID($PC, _ID)>>
<<if $activeSlave.reservedChildren > 0>>
	<<set $reservedChildren -= $activeSlave.reservedChildren>>
<</if>>
<<if $PC.mother == _ID>>
	<<set $PC.mother = $missingParentID>>
	<<set _missingID = 1>>
<</if>>
<<if $PC.father == _ID>>
	<<set $PC.father = $missingParentID>>
	<<set _missingID = 1>>
<</if>>
<<if $PC.sisters > 0>>
	<<if areSisters($PC, $activeSlave) > 0>>
		<<set $PC.sisters-->>
	<</if>>
<</if>>
<<if $PC.daughters > 0>>
	<<if $activeSlave.father == -1 || $activeSlave.mother == -1>>
		<<set $PC.daughters-->>
	<</if>>
<</if>>

<<if _x >= 0 && _x < _SL>>
	<<if $incubator > 0>>
		<<for _z = 0; _z < $tanks.length; _z++>>
			<<if _ID == $tanks[_z].mother>>
				<<set $tanks[_z].mother = $missingParentID>>
				<<set _missingID = 1>>
			<</if>>
			<<if _ID == $tanks[_z].father>>
				<<set $tanks[_z].father = $missingParentID>>
				<<set _missingID = 1>>
			<</if>>
		<</for>>
	<</if>>
	<<for _y = 0; _y < _SL; _y++>>
		<<set WombZeroID($slaves[_y], _ID)>> /* This check is complex, should be done in JS now, all needed will be done here. */
		<<if $activeSlave.daughters > 0>>
			<<if $slaves[_y].mother == _ID>>
				<<set $slaves[_y].mother = $missingParentID>>
			<</if>>
			<<if $slaves[_y].father == _ID>>
				<<set $slaves[_y].father = $missingParentID>>
			<</if>>
			<<set _missingID = 1>>
		<</if>>
		<<if $activeSlave.mother > 0 || $activeSlave.father > 0>>
			<<if $activeSlave.mother == $slaves[_y].ID || $activeSlave.father == $slaves[_y].ID>>
				<<set $slaves[_y].daughters-->>
			<</if>>
		<</if>>
		<<if $activeSlave.sisters > 0>>
			<<if areSisters($activeSlave, $slaves[_y]) > 0>>
				<<set $slaves[_y].sisters-->>
			<</if>>
		<</if>>
		<<if $slaves[_y].ID == $activeSlave.relationTarget>>
			<<set $slaves[_y].relation = 0, $slaves[_y].relationTarget = 0>>
		<</if>>
		<<if $slaves[_y].milkSource != 0>>
			<<if $slaves[_y].milkSource == _ID>>
				<<set $slaves[_y].milkSource =0, $slaves[_y].inflation = 0, $slaves[_y].inflationType = "none", $slaves[_y].inflationMethod = 0>>
			<</if>>
		<</if>>
		<<if $slaves[_y].cumSource != 0>>
			<<if $slaves[_y].cumSource == _ID>>
				<<set $slaves[_y].cumSource = 0, $slaves[_y].inflation = 0, $slaves[_y].inflationType = "none", $slaves[_y].inflationMethod = 0>>
			<</if>>
		<</if>>
		<<if $slaves[_y].ID == $activeSlave.relationshipTarget>>
			<<set $slaves[_y].relationship = 0, $slaves[_y].relationshipTarget = 0>>
		<</if>>
		<<if $slaves[_y].ID == $activeSlave.rivalryTarget>>
			<<set $slaves[_y].rivalry = 0, $slaves[_y].rivalryTarget = 0>>
		<</if>>
	<</for>>

	/* remove from Pit fighters list, if needed */
	<<set $fighterIDs.delete(_ID)>>

	/* remove from Coursing Association, if needed */
	<<if $Lurcher != 0 && $Lurcher.ID == _ID>>
		<<set $Lurcher = 0>>
	<</if>>

	<<if Array.isArray($personalAttention)>>
		<<set _rasi = $personalAttention.findIndex(function(s) { return s.ID == _ID; })>>
		<<if _rasi != -1>>
			<<set $personalAttention.deleteAt(_rasi)>>
			<<if $personalAttention.length == 0>>
				<<if $PC.career == "escort">>
					<<set $personalAttention = "whoring">>
				<<elseif $PC.career == "servant">>
					<<set $personalAttention = "upkeep">>
				<<else>>
					<<set $personalAttention = "business">>
				<</if>>
			<</if>>
		<</if>>
	<</if>>

	/% Remove from facility array or leadership role, if needed %/
	<<removeJob $activeSlave $activeSlave.assignment>>

	<<if $traitor != 0>>
		<<if _ID == $traitor.pregSource>>
			<<set $traitor.pregSource = 0>>
		<</if>>
		<<if $traitor.mother == _ID>>
			<<set $traitor.mother = $missingParentID>>
			<<set _missingID = 1>>
		<</if>>
		<<if $traitor.father == _ID>>
			<<set $traitor.father = $missingParentID>>
			<<set _missingID = 1>>
		<</if>>
	<</if>>
	<<if $boomerangSlave != 0>>
		<<if _ID == $boomerangSlave.pregSource>>
			<<set $boomerangSlave.pregSource = 0>>
		<</if>>
		<<if $boomerangSlave.mother == _ID>>
			<<set $boomerangSlave.mother = $missingParentID>>
			<<set _missingID = 1>>
		<</if>>
		<<if $boomerangSlave.father == _ID>>
			<<set $boomerangSlave.father = $missingParentID>>
			<<set _missingID = 1>>
		<</if>>
	<</if>>
	
	<<set _o = $organs.findIndex(function(s) { return s.ID == $activeSlave.ID; })>>
	<<if _o != -1>>
		<<set $organs.deleteAt(_o)>>
	<</if>>
	<<set _o = $limbs.findIndex(function(s) { return s.ID == $activeSlave.ID; })>>
	<<if _o != -1>>
		<<set $limbs.deleteAt(_o)>>
	<</if>>
	
	<<set _dump = removeSlave(_x), _SL--, $activeSlave = 0>>
	
	<<set _o = $genePool.findIndex(function(s) { return s.ID = _ID; })>>
	<<if def _o>>
		<<set _dontDeleteMe = 0>>
		<<if $traitor != 0>>
			<<if isImpregnatedBy($traitor, $genePool[_o]) || $traitor.ID == _ID>> /* did we impregnate the traitor, or are we the traitor? */
				<<set _dontDeleteMe = 1>>
			<</if>>
		<</if>>
		<<if $boomerangSlave != 0>>
			<<if isImpregnatedBy($boomerangSlave, $genePool[_o]) || $boomerangSlave.ID == _ID)>> /* did we impregnate the boomerang, or are we the boomerang? */
				<<set _dontDeleteMe = 1>>
			<</if>>
		<</if>>
		<<if _dontDeleteMe == 0>> /* avoid going through this loop if possible */
			<<for _rasi = 0; _rasi < _SL; _rasi++>>
				<<if $slaves[_rasi].ID != _ID && isImpregnatedBy($slaves[_rasi], $genePool[_o])>> /* have we impregnated a slave that is not ourself? */
					<<set _dontDeleteMe = 1>>
					<<break>>
				<</if>>
			<</for>>
		<</if>>
		<<if _dontDeleteMe == 0>>
			<<set $genePool.deleteAt(_o)>>	
		<</if>>
	<</if>>
	
	<<if _missingID == 1>>
		<<set $missingParentID-->>
	<</if>>
<</if>>
