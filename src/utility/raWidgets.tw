:: RA widgets [widget nobr]

/%
 % Call as <<RAChangeActivation>>
 %/
<<widget "RAChangeActivation">>
<<replace #activation>>

    <<if ($currentRule.condition.id === "true")>>
        (always): <br> ''always.''

    <<elseif ($currentRule.condition.id === "false")>>
        (never): <br> ''never''

    <<else>>
        <<set _activation = getVariable($currentRule.condition)>>

        (_activation): <br>

        <<switch $currentRule.condition.id>>
        <<case "<">>
            When ''_activation'' is ''less than''
            <<textbox "$currentRule.condition.second.value" $currentRule.condition.second.value>>
        <<case "<=">>
            When ''_activation'' is
            <<textbox "$currentRule.condition.second.value" $currentRule.condition.second.value>> ''or less''

        <<case ">" ">=">>
            (no upper limit)

        <<case "&&" "||">>
            <<if $currentRule.condition.first.id == "<">>
                When ''_activation'' is ''less than''
                <<textbox "$currentRule.condition.first.second.value" $currentRule.condition.first.second.value>>
            <<else>>
                When ''_activation'' is
                <<textbox "$currentRule.condition.first.second.value" $currentRule.condition.first.second.value>> ''or less''
            <</if>>
        <</switch>>

        <<link "<">>
            <<set $currentRule.condition = changeComparison($currentRule.condition, "<")>>
            <<RAChangeActivation>>
        <</link>>
        |
        <<link "&le;">>
            <<set $currentRule.condition = changeComparison($currentRule.condition, "<=")>>
            <<RAChangeActivation>>
        <</link>>
        |
        <<link "no upper limit">>
            <<set $currentRule.condition = removeComparison($currentRule.condition, "upper")>>
            <<RAChangeActivation>>
        <</link>>

        <br>
        <<switch $currentRule.condition.id>>
        <<case "<" "<=" ">" ">=">>
            and
        <<case "&&">>
            ''and''
            |
            <<link "or">>
                <<set $currentRule.condition = changeConnective($currentRule.condition, "||")>>
                <<RAChangeActivation>>
            <</link>>
        <<case "||">>
            <<link "and">>
                <<set $currentRule.condition = changeConnective($currentRule.condition, "&&")>>
                <<RAChangeActivation>>
            <</link>>
            |
            ''or''
        <</switch>>
        <br>

        <<switch $currentRule.condition.id>>
        <<case "<" "<=">>
            (no lower limit)

        <<case ">">>
            When ''_activation'' is ''more than''
            <<textbox "$currentRule.condition.second.value" $currentRule.condition.second.value>>
        <<case ">=">>
            When ''_activation'' is
            <<textbox "$currentRule.condition.second.value" $currentRule.condition.second.value>> ''or more''

        <<case "&&" "||">>
            <<if ($currentRule.condition.second.id == ">")>>
                When ''_activation'' is ''more than''
                <<textbox "$currentRule.condition.second.second.value" $currentRule.condition.second.second.value>>
            <<else>>
                When ''_activation'' is
                <<textbox "$currentRule.condition.second.second.value" $currentRule.condition.second.second.value>> ''or more''
            <</if>>
        <</switch>>

        <<link ">">>
            <<set $currentRule.condition = changeComparison($currentRule.condition, ">")>>
            <<RAChangeActivation>>
        <</link>>
        |
        <<link "&ge;">>
            <<set $currentRule.condition = changeComparison($currentRule.condition, ">=")>>
            <<RAChangeActivation>>
        <</link>>
        |
        <<link "no lower limit">>
            <<set $currentRule.condition = removeComparison($currentRule.condition, "lower")>>
            <<RAChangeActivation>>
        <</link>>

        <<switch _activation>>
        <<case "devotion">>
            <br>@@.darkviolet;Very hateful@@: under -95, @@.darkviolet;Hateful@@: -95 to under -50, @@.mediumorchid;Resistant@@: -50 to under -20, @@.yellow;Ambivalent@@: -20 to 20, @@.hotpink;Accepting@@: over 20 to 50, @@.deeppink;Devoted@@: over 50 to 95, @@.magenta;Worshipful@@: over 95
        <<case "trust">>
            <br>@@.goldenrod;Extremely terrified@@: under -95, @@.goldenrod;Terrified@@: -95 to under -50, @@.gold;Frightened@@: -50 to under -20,
            <br>@@.yellow;Fearful@@: -20 to 20, @@.mediumaquamarine;Careful@@: over 40 to 50, @@.mediumseagreen;Trusting@@: 50 to 95, @@.seagreen;Total trust@@: over 95
        <<case "health">>
            <br>@@.red;Death@@: under -100, @@.red;Near death@@: -100 to less than -90, @@.red;Extremely unhealthy@@: -90 to less than -50, @@.red;Unhealthy@@: -50 to less than -20
            <br>@@.green;Healthy@@: -20 to 20, @@.green;Very healthy@@: 20 to 50, @@.green;Extremely healthy@@: over 50 to 90, @@.green;Unnaturally healthy@@: over 90
        <<case "sex drive">>
            <br>@@.red;Frigid@@: 20 or under, @@.red;Poor@@: 21 to 40, @@.yellow;Average@@: 41 to 60, @@.green;Powerful@@: 61 to 80, @@.green;Sex addict@@: 81 to 99, @@.green;Nympho@@: 100
        <<case "weight">>
            <br>@@.red;Emaciated@@: under -95, @@.red;Skinny@@: -95 to less than -30,
            <br>Thin: -30 to less than -10, Average weight: -10 to 10, Plush: over 10 to 30,
            <br>@@.red;Fat@@: over 30 to 95, @@.red;Overweight@@: over 95
        <<case "lactation">>
            <br>// 0 - none, 1 - natural, 2 - lactation implant. //
        <<case "preg">>
            <br>// >1 - pregnancy week(s), 0 - not pregnant, -1 - on contraceptives, -2 - barren. //
        <<case "pregType">>
            <br>// Fetus count, rule can be applied only after week 10 of pregnancy. //
        <<case "bellyImplant">>
            <br>// Volume of belly implant in ccs. -1 - none. //
        <<case "belly">>
            <br>// Volume of belly in ccs. Any source. //
        <<case "custom">>
            <br>// Enter custom condition. //
        <</switch>>
    <</if>>
<</replace>>
<</widget>>

/%
 % Call as <<RACommonAssignmentVariables>>
 %/
<<widget "RACommonAssignmentVariables">>
    <<set _penthouseAssignments = [
		"rest",
		"whore",
		"please you",
		"get milked",
		"be a servant",
		"take classes",
		"stay confined",
		"serve the public",
		"work a glory hore",
		"be a subordinate slave"
	]>>

	<<set _facilityAssignments = [
		"rest in the spa",
		"serve in the club",
		"work as a servant",
		"work in the dairy",
		"work in the brothel",
		"learn in the schoolroom",
		"live with your Head Girl",
		"be confined in the arcade",
		"serve in the master suite",
		"get treatment in the clinic",
		"be confined in the cellblock"
	]>>
<</widget>>

/%
 % Call as <<RANormalizeAssignments>>
 %/
<<widget "RANormalizeAssignments">>
<<RACommonAssignmentVariables>>

<<switch $args[0]>>
<<case "assignment">>
	<<if $currentRule.assignment.length > 0>>
		<<set $currentRule.excludeAssignment = []>>
		<<set $currentRule.facilityRemove = false>>
		<<RAChangeAssignFacility>>
	<</if>>
	/% RAChangeExcludeAssignment is also responsible for the case that both
	 % assignment and excludeAssignment are empty (it sets some colors and
	 % stuff) so we always need to call it.
	 %/
	<<RAChangeExcludeAssignment>>
	<<RAChangeApplyAssignment>>
	<<RARuleModified>>

<<case "excludeAssignment">>
	<<if $currentRule.excludeAssignment.length > 0>>
		<<set $currentRule.assignment = []>>
		<<RAChangeApplyAssignment>>
	<</if>>
	<<RAChangeExcludeAssignment>>
	<<RARuleModified>>

<<case "facility">>
	<<if $currentRule.facility.length > 0>>
		<<set $currentRule.excludeFacility = []>>
		<<if !$currentRule.facility.includes($currentRule.setAssignment)>>
			<<set $currentRule.facilityRemove = false>>
			<<RAChangeAssignFacility>>
		<</if>>
	<</if>>
	/% same as above with RAChangeExcludeAssignment %/
	<<RAChangeExcludeFacility>>
	<<RAChangeApplyFacility>>
	<<RARuleModified>>

<<case "excludeFacility">>
	<<if $currentRule.excludeFacility.length > 0>>
		<<set $currentRule.facility = []>>
		<<if $currentRule.excludeFacility.includes($currentRule.setAssignment)>>
			<<set $currentRule.facilityRemove = false>>
			<<RAChangeAssignFacility>>
		<</if>>
		<<RAChangeApplyFacility>>
	<</if>>
	<<RAChangeExcludeFacility>>
	<<RARuleModified>>

<<case "setAssignment">>
	<<if _facilityAssignments.includes($currentRule.setAssignment) && $currentRule.facilityRemove>>
		/% If a rule sends a slave to a facility that it does not
		 % manage (due to exclusion or inclusion settings) and
		 % facilityRemove is turned on, then the slave would be sent to
		 % the facility, the rule would not apply anymore and so she
		 % would be removed from the facility.  So we try to prevent
		 % that.
		 %/
		<<if $currentRule.excludeFacility.includes($currentRule.setAssignment)>>
			<<set $currentRule.excludeFacility.delete($currentRule.setAssignment)>>
			<<RAChangeExcludeFacility>>
		<</if>>
		<<if $currentRule.facility.length > 0 && !$currentRule.facility.includes($currentRule.setAssignment)>>
			<<set $currentRule.facility.push($currentRule.setAssignment)>>
			<<RAChangeApplyFacility>>
		<</if>>
	<<else>>
		/% facilityRemove would have no effect when the assignment is not in a
		 % facility, but we reset anyway to prevent potential surprises to the
		 % user later
		 %/
		<<set $currentRule.facilityRemove = false>>
	<</if>>
	<<RAChangeSetAssignment>>
	<<RAChangeAssignFacility>>
	<<RARuleModified>>

<<case "facilityRemove">>
	<<if $currentRule.facilityRemove>>
		/% If facilityRemove is true that means that it was just set
		 % which means that setAssignment is a facility (because otherwise
		 % the UI that enables facilityRemove wouldn't be visible)
		 %/
		<<set $currentRule.assignment = []>>
		<<set $currentRule.excludeFacility.delete($currentRule.setAssignment)>>
		<<if $currentRule.facility.length > 0>>
			<<set $currentRule.facility.push($currentRule.setAssignment)>>
			<<RAChangeApplyFacility>>
		<</if>>
		/% again the thing with the RAChangeExcludeAssignment %/
		<<RAChangeExcludeAssignment>>
		<<RAChangeApplyAssignment>>
		<<RAChangeExcludeFacility>>
	<<else>>
		/% nothing to do here really... %/
	<</if>>
	<<RAChangeAssignFacility>>
	<<RARuleModified>>

<</switch>>
<</widget>>

/%
 % Call as <<RAChangeApplyAssignment>>
 %/
<<widget "RAChangeApplyAssignment">>
<<if (ndef $currentRule.assignment)>><<set $currentRule.assignment = []>><</if>>
<<if (ndef $currentRule.excludeAssignment)>><<set $currentRule.excludeAssignment = []>><</if>>

<<set _rest = _whore = _fucktoy = _milked = _servant = _classes = _confined = _public = _gloryhole = _subordinate = false>>
<<for _a = 0; _a < $currentRule.assignment.length; _a++>>
	<<switch $currentRule.assignment[_a]>>
	<<case "rest">>                     <<set _rest = true>>
	<<case "whore">>                    <<set _whore = true>>
	<<case "please you">>               <<set _fucktoy = true>>
	<<case "get milked">>               <<set _milked = true>>
	<<case "be a servant">>             <<set _servant = true>>
	<<case "take classes">>             <<set _classes = true>>
	<<case "stay confined">>            <<set _confined = true>>
	<<case "serve the public">>         <<set _public = true>>
	<<case "work a glory hole">>        <<set _gloryhole = true>>
	<<case "be a subordinate slave">>   <<set _subordinate = true>>
	<</switch>>
<</for>>

<<replace #applyassignment>>
<<if _rest || _fucktoy || _servant || _confined || _whore || _public || _milked || _subordinate || _gloryhole || _classes>>
	Apply to assignments:
	<<link "All">>
		<<set $currentRule.assignment = []>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<<else>>
	@@.gray;Apply to assignments:@@ ''All''
<</if>>
|
<<if !_rest>>
	<<link "Rest">>
		<<set $currentRule.assignment.push("rest")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<<else>>
	''Rest''
	<<link Stop>>
		<<set $currentRule.assignment.delete("rest")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<</if>>
|
<<if !_fucktoy>>
	<<link "Fucktoy">>
		<<set $currentRule.assignment.push("please you")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<<else>>
	''Fucktoy''
	<<link Stop>>
		<<set $currentRule.assignment.delete("please you")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<</if>>
|
<<if !_subordinate>>
	<<link "Subordinate Slave">>
		<<set $currentRule.assignment.push("be a subordinate slave")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<<else>>
	''Subordinate Slave''
	<<link Stop>>
		<<set $currentRule.assignment.delete("be a subordinate slave")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<</if>>
|
<<if !_servant>>
	<<link "House Servant">>
		<<set $currentRule.assignment.push("be a servant")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<<else>>
	''House Servant''
	<<link Stop>>
		<<set $currentRule.assignment.delete("be a servant")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<</if>>
|
<<if !_confined>>
	<<link "Confined">>
		<<set $currentRule.assignment.push("stay confined")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<<else>>
	''Confined''
	<<link Stop>>
		<<set $currentRule.assignment.delete("stay confined")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<</if>>
|
<<if !_whore>>
	<<link "Whore">>
		<<set $currentRule.assignment.push("whore")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<<else>>
	''Whore''
	<<link Stop>>
		<<set $currentRule.assignment.delete("whore")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<</if>>
|
<<if !_public>>
	<<link "Public Servant">>
		<<set $currentRule.assignment.push("serve the public")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<<else>>
	''Public Servant''
	<<link Stop>>
		<<set $currentRule.assignment.delete("serve the public")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<</if>>
|
<<if !_classes>>
	<<link "Classes">>
		<<set $currentRule.assignment.push("take classes")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<<else>>
	''Classes''
	<<link Stop>>
		<<set $currentRule.assignment.delete("take classes")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<</if>>
|
<<if !_milked>>
	<<link "Milked">>
		<<set $currentRule.assignment.push("get milked")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<<else>>
	''Milking''
	<<link Stop>>
		<<set $currentRule.assignment.delete("get milked")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<</if>>
|
<<if !_gloryhole>>
	<<link "Gloryhole">>
		<<set $currentRule.assignment.push("work a glory hole")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<<else>>
	''Gloryhole''
	<<link Stop>>
		<<set $currentRule.assignment.delete("work a glory hole")>>
		<<RANormalizeAssignments "assignment">>
	<</link>>
<</if>>
<</replace>>
<</widget>>

/%
 % Call as <<RAChangeExcludeAssignment>>
 %/
<<widget "RAChangeExcludeAssignment">>
<<if (ndef $currentRule.assignment)>><<set $currentRule.assignment = []>><</if>>
<<if (ndef $currentRule.excludeAssignment)>><<set $currentRule.excludeAssignment = []>><</if>>

<<set _rest = _whore = _fucktoy = _milked = _servant = _classes = _confined = _public = _gloryhole = _subordinate = false>>
<<for _a = 0; _a < $currentRule.excludeAssignment.length; _a++>>
	<<switch $currentRule.excludeAssignment[_a]>>
	<<case "rest">>                     <<set _rest = true>>
	<<case "whore">>                    <<set _whore = true>>
	<<case "please you">>               <<set _fucktoy = true>>
	<<case "get milked">>               <<set _milked = true>>
	<<case "be a servant">>             <<set _servant = true>>
	<<case "take classes">>             <<set _classes = true>>
	<<case "stay confined">>            <<set _confined = true>>
	<<case "serve the public">>         <<set _public = true>>
	<<case "work a glory hole">>        <<set _gloryhole = true>>
	<<case "be a subordinate slave">>   <<set _subordinate = true>>
	<</switch>>
<</for>>

<<replace #excludeassignment>>
<<if _rest || _fucktoy || _servant || _confined || _whore || _public || _milked || _subordinate || _gloryhole || _classes>>
	Include all assignments except:
	<<link "None">>
		<<set $currentRule.excludeAssignment = []>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<<elseif ($currentRule.assignment.length > 0)>>
	@@.gray;Exclude assignments:@@ ''None''
<<else>>
	Excluded assignments: ''None''
<</if>>
|
<<if !_rest>>
	<<link "Rest">>
		<<set $currentRule.excludeAssignment.push("rest")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<<else>>
	''Rest''
	<<link Stop>>
		<<set $currentRule.excludeAssignment.delete("rest")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<</if>>
|
<<if !_fucktoy>>
	<<link "Fucktoy">>
		<<set $currentRule.excludeAssignment.push("please you")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<<else>>
	''Fucktoy''
	<<link Stop>>
		<<set $currentRule.excludeAssignment.delete("please you")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<</if>>
|
<<if !_subordinate>>
	<<link "Subordinate Slave">>
		<<set $currentRule.excludeAssignment.push("be a subordinate slave")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<<else>>
	''Subordinate Slave''
	<<link Stop>>
		<<set $currentRule.excludeAssignment.delete("be a subordinate slave")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<</if>>
|
<<if !_servant>>
	<<link "House Servant">>
		<<set $currentRule.excludeAssignment.push("be a servant")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<<else>>
	''House Servant''
	<<link Stop>>
		<<set $currentRule.excludeAssignment.delete("be a servant")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<</if>>
|
<<if !_confined>>
	<<link "Confined">>
		<<set $currentRule.excludeAssignment.push("stay confined")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<<else>>
	''Confined''
	<<link Stop>>
		<<set $currentRule.excludeAssignment.delete("stay confined")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<</if>>
|
<<if !_whore>>
	<<link "Whore">>
		<<set $currentRule.excludeAssignment.push("whore")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<<else>>
	''Whore''
	<<link Stop>>
		<<set $currentRule.excludeAssignment.delete("whore")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<</if>>
|
<<if !_public>>
	<<link "Public Servant">>
		<<set $currentRule.excludeAssignment.push("serve the public")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<<else>>
	''Public Servant''
	<<link Stop>>
		<<set $currentRule.excludeAssignment.delete("serve the public")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<</if>>
|
<<if !_classes>>
	<<link "Classes">>
		<<set $currentRule.excludeAssignment.push("take classes")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<<else>>
	''Classes''
	<<link Stop>>
		<<set $currentRule.excludeAssignment.delete("take classes")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<</if>>
|
<<if !_milked>>
	<<link "Milked">>
		<<set $currentRule.excludeAssignment.push("get milked")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<<else>>
	''Milking''
	<<link Stop>>
		<<set $currentRule.excludeAssignment.delete("get milked")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<</if>>
|
<<if !_gloryhole>>
	<<link "Gloryhole">>
		<<set $currentRule.excludeAssignment.push("work a glory hole")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<<else>>
	''Gloryhole''
	<<link Stop>>
		<<set $currentRule.excludeAssignment.delete("work a glory hole")>>
		<<RANormalizeAssignments "excludeAssignment">>
	<</link>>
<</if>>
|
<<link "Exclude all">>
	<<set $currentRule.excludeAssignment.push("work a glory hole")>>
	<<set $currentRule.excludeAssignment.push("get milked")>>
	<<set $currentRule.excludeAssignment.push("take classes")>>
	<<set $currentRule.excludeAssignment.push("serve the public")>>
	<<set $currentRule.excludeAssignment.push("whore")>>
	<<set $currentRule.excludeAssignment.push("stay confined")>>
	<<set $currentRule.excludeAssignment.push("be a servant")>>
	<<set $currentRule.excludeAssignment.push("be a subordinate slave")>>
	<<set $currentRule.excludeAssignment.push("please you")>>
	<<set $currentRule.excludeAssignment.push("rest")>>
	<<RANormalizeAssignments "excludeAssignment">>
<</link>>
<</replace>>
<</widget>>

/%
 % Call as <<RAChangeApplyFacility>>
 %/
<<widget "RAChangeApplyFacility">>
<<if (ndef $currentRule.facility)>><<set $currentRule.facility = []>><</if>>
<<if (ndef $currentRule.excludeFacility)>><<set $currentRule.excludeFacility = []>><</if>>

<<replace #applyfacility>>
<<if ($HGSuite > 0) || ($brothel > 0) || ($club > 0) || ($arcade > 0) || ($dairy > 0) || ($servantsQuarters > 0) || ($masterSuite > 0) || ($schoolroom > 0) || ($spa > 0) || ($clinic > 0) || ($cellblock > 0)>>
<br><br>
<<if ($currentRule.facility.length > 0)>>
	Apply to facilities:
	<<link "All">>
		<<set $currentRule.facility = []>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<<else>>
	@@.gray;Apply to facilities:@@ ''All''
<</if>>
<<if ($HGSuite > 0)>>
|
<<if !$currentRule.facility.includes("live with your Head Girl")>>
	<<link $HGSuiteNameCaps>>
		<<set $currentRule.facility.push("live with your Head Girl")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<<else>>
	''$HGSuiteNameCaps''
	<<link Stop>>
		<<set $currentRule.facility.delete("live with your Head Girl")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<</if>>
<</if>>
<<if ($brothel > 0)>>
|
<<if !$currentRule.facility.includes("work in the brothel")>>
	<<link $brothelNameCaps>>
		<<set $currentRule.facility.push("work in the brothel")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<<else>>
	''$brothelNameCaps''
	<<link Stop>>
		<<set $currentRule.facility.delete("work in the brothel")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<</if>>
<</if>>
<<if ($club > 0)>>
|
<<if !$currentRule.facility.includes("serve in the club")>>
	<<link $clubNameCaps>>
		<<set $currentRule.facility.push("serve in the club")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<<else>>
	''$clubNameCaps''
	<<link Stop>>
		<<set $currentRule.facility.delete("serve in the club")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<</if>>
<</if>>
<<if ($arcade > 0)>>
|
<<if !$currentRule.facility.includes("be confined in the arcade")>>
	<<link $arcadeNameCaps>>
		<<set $currentRule.facility.push("be confined in the arcade")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<<else>>
	''$arcadeNameCaps''
	<<link Stop>>
		<<set $currentRule.facility.delete("be confined in the arcade")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<</if>>
<</if>>
<<if ($dairy > 0)>>
|
<<if !$currentRule.facility.includes("work in the dairy")>>
	<<link $dairyNameCaps>>
		<<set $currentRule.facility.push("work in the dairy")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<<else>>
	''$dairyNameCaps''
	<<link Stop>>
		<<set $currentRule.facility.delete("work in the dairy")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<</if>>
<</if>>
<<if ($servantsQuarters > 0)>>
|
<<if !$currentRule.facility.includes("work as a servant")>>
	<<link $servantsQuartersNameCaps>>
		<<set $currentRule.facility.push("work as a servant")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<<else>>
	''$servantsQuartersNameCaps''
	<<link Stop>>
		<<set $currentRule.facility.delete("work as a servant")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<</if>>
<</if>>
<<if ($masterSuite > 0)>>
|
<<if !$currentRule.facility.includes("serve in the master suite")>>
	<<link $masterSuiteNameCaps>>
		<<set $currentRule.facility.push("serve in the master suite")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<<else>>
	''$masterSuiteNameCaps''
	<<link Stop>>
		<<set $currentRule.facility.delete("serve in the master suite")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<</if>>
<</if>>
<<if ($schoolroom > 0)>>
|
<<if !$currentRule.facility.includes("learn in the schoolroom")>>
	<<link $schoolroomNameCaps>>
		<<set $currentRule.facility.push("learn in the schoolroom")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<<else>>
	''$schoolroomNameCaps''
	<<link Stop>>
		<<set $currentRule.facility.delete("learn in the schoolroom")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<</if>>
<</if>>
<<if ($spa > 0)>>
|
<<if !$currentRule.facility.includes("rest in the spa")>>
	<<link $spaNameCaps>>
		<<set $currentRule.facility.push("rest in the spa")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<<else>>
	''$spaNameCaps''
	<<link Stop>>
		<<set $currentRule.facility.delete("rest in the spa")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<</if>>
<</if>>
<<if ($clinic > 0)>>
|
<<if !$currentRule.facility.includes("get treatment in the clinic")>>
	<<link $clinicNameCaps>>
		<<set $currentRule.facility.push("get treatment in the clinic")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<<else>>
	''$clinicNameCaps''
	<<link Stop>>
		<<set $currentRule.facility.delete("get treatment in the clinic")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<</if>>
<</if>>
<<if ($cellblock > 0)>>
|
<<if !$currentRule.facility.includes("be confined in the cellblock")>>
	<<link $cellblockNameCaps>>
		<<set $currentRule.facility.push("be confined in the cellblock")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<<else>>
	''$cellblockNameCaps''
	<<link Stop>>
		<<set $currentRule.facility.delete("be confined in the cellblock")>>
		<<RANormalizeAssignments "facility">>
	<</link>>
<</if>>
<</if>>
<</if>>
<</replace>>
<</widget>>

/%
 % Call as <<RAChangeExcludeFacility>>
 %/
<<widget "RAChangeExcludeFacility">>
<<if (ndef $currentRule.facility)>><<set $currentRule.facility = []>><</if>>
<<if (ndef $currentRule.excludeFacility)>><<set $currentRule.excludeFacility = []>><</if>>

<<replace #excludefacility>>
<<if ($HGSuite > 0) || ($brothel > 0) || ($club > 0) || ($arcade > 0) || ($dairy > 0) || ($servantsQuarters > 0) || ($masterSuite > 0) || ($schoolroom > 0) || ($spa > 0) || ($clinic > 0) || ($cellblock > 0)>>
<br>
<<if ($currentRule.excludeFacility.length > 0)>>
	Applying to all facilities except:
	<<link "None">>
		<<set $currentRule.excludeFacility = []>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<<elseif ($currentRule.facility.length > 0)>>
	@@.gray;Exclude facilities:@@ ''None''
<<else>>
	Excluded facilities: ''None''
<</if>>
<<if ($HGSuite > 0)>>
|
<<if !$currentRule.excludeFacility.includes("live with your Head Girl")>>
	<<link $HGSuiteNameCaps>>
		<<set $currentRule.excludeFacility.push("live with your Head Girl")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<<else>>
	''$HGSuiteNameCaps''
	<<link Stop>>
		<<set $currentRule.excludeFacility.delete("live with your Head Girl")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<</if>>
<</if>>
<<if ($brothel > 0)>>
|
<<if !$currentRule.excludeFacility.includes("work in the brothel")>>
	<<link $brothelNameCaps>>
		<<set $currentRule.excludeFacility.push("work in the brothel")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<<else>>
	''$brothelNameCaps''
	<<link Stop>>
		<<set $currentRule.excludeFacility.delete("work in the brothel")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<</if>>
<</if>>
<<if ($club > 0)>>
|
<<if !$currentRule.excludeFacility.includes("serve in the club")>>
	<<link $clubNameCaps>>
		<<set $currentRule.excludeFacility.push("serve in the club")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<<else>>
	''$clubNameCaps''
	<<link Stop>>
		<<set $currentRule.excludeFacility.delete("serve in the club")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<</if>>
<</if>>
<<if ($arcade > 0)>>
|
<<if !$currentRule.excludeFacility.includes("be confined in the arcade")>>
	<<link $arcadeNameCaps>>
		<<set $currentRule.excludeFacility.push("be confined in the arcade")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<<else>>
	''$arcadeNameCaps''
	<<link Stop>>
		<<set $currentRule.excludeFacility.delete("be confined in the arcade")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<</if>>
<</if>>
<<if ($dairy > 0)>>
|
<<if !$currentRule.excludeFacility.includes("work in the dairy")>>
	<<link $dairyNameCaps>>
		<<set $currentRule.excludeFacility.push("work in the dairy")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<<else>>
	''$dairyNameCaps''
	<<link Stop>>
		<<set $currentRule.excludeFacility.delete("work in the dairy")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<</if>>
<</if>>
<<if ($servantsQuarters > 0)>>
|
<<if !$currentRule.excludeFacility.includes("work as a servant")>>
	<<link $servantsQuartersNameCaps>>
		<<set $currentRule.excludeFacility.push("work as a servant")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<<else>>
	''$servantsQuartersNameCaps''
	<<link Stop>>
		<<set $currentRule.excludeFacility.delete("work as a servant")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<</if>>
<</if>>
<<if ($masterSuite > 0)>>
|
<<if !$currentRule.excludeFacility.includes("serve in the master suite")>>
	<<link $masterSuiteNameCaps>>
		<<set $currentRule.excludeFacility.push("serve in the master suite")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<<else>>
	''$masterSuiteNameCaps''
	<<link Stop>>
		<<set $currentRule.excludeFacility.delete("serve in the master suite")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<</if>>
<</if>>
<<if ($schoolroom > 0)>>
|
<<if !$currentRule.excludeFacility.includes("learn in the schoolroom")>>
	<<link $schoolroomNameCaps>>
		<<set $currentRule.excludeFacility.push("learn in the schoolroom")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<<else>>
	''$schoolroomNameCaps''
	<<link Stop>>
		<<set $currentRule.excludeFacility.delete("learn in the schoolroom")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<</if>>
<</if>>
<<if ($spa > 0)>>
|
<<if !$currentRule.excludeFacility.includes("rest in the spa")>>
	<<link $spaNameCaps>>
		<<set $currentRule.excludeFacility.push("rest in the spa")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<<else>>
	''$spaNameCaps''
	<<link Stop>>
		<<set $currentRule.excludeFacility.delete("rest in the spa")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<</if>>
<</if>>
<<if ($clinic > 0)>>
|
<<if !$currentRule.excludeFacility.includes("get treatment in the clinic")>>
	<<link $clinicNameCaps>>
		<<set $currentRule.excludeFacility.push("get treatment in the clinic")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<<else>>
	''$clinicNameCaps''
	<<link Stop>>
		<<set $currentRule.excludeFacility.delete("get treatment in the clinic")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<</if>>
<</if>>
<<if ($cellblock > 0)>>
|
<<if !$currentRule.excludeFacility.includes("be confined in the cellblock")>>
	<<link $cellblockNameCaps>>
		<<set $currentRule.excludeFacility.push("be confined in the cellblock")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<<else>>
	''$cellblockNameCaps''
	<<link Stop>>
		<<set $currentRule.excludeFacility.delete("be confined in the cellblock")>>
		<<RANormalizeAssignments "excludeFacility">>
	<</link>>
<</if>>
<</if>>
|
<<link "Exclude all">>
	<<set $currentRule.excludeFacility.push("be confined in the cellblock")>>
	<<set $currentRule.excludeFacility.push("get treatment in the clinic")>>
	<<set $currentRule.excludeFacility.push("rest in the spa")>>
	<<set $currentRule.excludeFacility.push("learn in the schoolroom")>>
	<<set $currentRule.excludeFacility.push("serve in the master suite")>>
	<<set $currentRule.excludeFacility.push("work as a servant")>>
	<<set $currentRule.excludeFacility.push("work in the dairy")>>
	<<set $currentRule.excludeFacility.push("be confined in the arcade")>>
	<<set $currentRule.excludeFacility.push("serve in the club")>>
	<<set $currentRule.excludeFacility.push("work in the brothel")>>
	<<set $currentRule.excludeFacility.push("live with your Head Girl")>>
	<<RANormalizeAssignments "excludeFacility">>
<</link>>
<</if>>
<</replace>>
<</widget>>

/%
 % Call as <<RAChangeSetAssignment>>
 %/
<<widget "RAChangeSetAssignment">>
<<RACommonAssignmentVariables>>

<<if (ndef $currentRule.assignment)>><<set $currentRule.assignment = []>><</if>>
<<if (ndef $currentRule.excludeAssignment)>><<set $currentRule.excludeAssignment = []>><</if>>

<<replace #setassignment>>
<br><br>
<<if _penthouseAssignments.includes($currentRule.setAssignment)>>
	Automatically set assignment:
	<<link "None">>
		<<set $currentRule.setAssignment = "no default setting">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	@@.gray;Automatically set assignment:@@ ''None''
<</if>>
|
<<if ($currentRule.setAssignment != "rest")>>
	<<link "Rest">>
		<<set $currentRule.setAssignment = "rest">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''Rest''
<</if>>
|
<<if ($currentRule.setAssignment != "please you")>>
	<<link "Fucktoy">>
		<<set $currentRule.setAssignment = "please you">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''Fucktoy''
<</if>>
|
<<if ($currentRule.setAssignment != "be a servant")>>
	<<link "House Servant">>
		<<set $currentRule.setAssignment = "be a servant">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''House Servant''
<</if>>
|
<<if ($currentRule.setAssignment != "stay confined")>>
	<<link "Confined">>
		<<set $currentRule.setAssignment = "stay confined">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''Confined''
<</if>>
|
<<if ($currentRule.setAssignment != "whore")>>
	<<link "Whore">>
		<<set $currentRule.setAssignment = "whore">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''Whore''
<</if>>
|
<<if ($currentRule.setAssignment != "serve the public")>>
	<<link "Public Servant">>
		<<set $currentRule.setAssignment = "serve the public">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''Public Servant''
<</if>>
|
<<if ($currentRule.setAssignment != "take classes")>>
	<<link "Classes">>
		<<set $currentRule.setAssignment = "take classes">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''Classes''
<</if>>
|
<<if ($currentRule.setAssignment != "get milked")>>
	<<link "Milking">>
		<<set $currentRule.setAssignment = "get milked">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''Milking''
<</if>>
|
<<if ($currentRule.setAssignment != "work a glory hole")>>
	<<link "Gloryhole">>
		<<set $currentRule.setAssignment = "work a glory hole">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''Gloryhole''
<</if>>
|
<<if ($currentRule.setAssignment != "choose her own job")>>
	<<link "Let her choose">>
		<<set $currentRule.setAssignment = "choose her own job">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''Let her choose''
<</if>>
<</replace>>
<</widget>>

/%
 % Call as <<RAChangeAssignFacility>>
 %/
<<widget "RAChangeAssignFacility">>
<<RACommonAssignmentVariables>>

<<if (ndef $currentRule.facility)>><<set $currentRule.facility = []>><</if>>
<<if (ndef $currentRule.excludeFacility)>><<set $currentRule.excludeFacility = []>><</if>>

<<replace #assignfacility>>
<<if ($HGSuite > 0) || ($brothel > 0) || ($club > 0) || ($arcade > 0) || ($dairy > 0) || ($servantsQuarters > 0) || ($masterSuite > 0) || ($schoolroom > 0) || ($spa > 0) || ($clinic > 0) || ($cellblock > 0)>>
<br>
<<if _facilityAssignments.includes($currentRule.setAssignment)>>
	Automatically assigning slaves to facility (when possible):
	<<link "None">>
		<<set $currentRule.setAssignment = "no default setting">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	@@.gray;Automatically assign slaves to facility:@@ ''None''
<</if>>
<<if ($HGSuite > 0)>>
|
<<if ($currentRule.setAssignment != "live with your Head Girl")>>
	<<link $HGSuiteNameCaps>>
		<<set $currentRule.setAssignment = "live with your Head Girl">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''$HGSuiteNameCaps''<<if $HGSuiteSlaves >= $HGSuite>> @@.red;(full)@@<</if>>
<</if>>
<</if>>
<<if ($brothel > 0)>>
|
<<if ($currentRule.setAssignment != "work in the brothel")>>
	<<link $brothelNameCaps>>
		<<set $currentRule.setAssignment = "work in the brothel">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''$brothelNameCaps''<<if $brothelSlaves >= $brothel>> @@.red;(full)@@<</if>>
<</if>>
<</if>>
<<if ($club > 0)>>
|
<<if ($currentRule.setAssignment != "serve in the club")>>
	<<link $clubNameCaps>>
		<<set $currentRule.setAssignment = "serve in the club">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''$clubNameCaps''<<if $clubSlaves >= $club>> @@.red;(full)@@<</if>>
<</if>>
<</if>>
<<if ($arcade > 0)>>
|
<<if ($currentRule.setAssignment != "be confined in the arcade")>>
	<<link $arcadeNameCaps>>
		<<set $currentRule.setAssignment = "be confined in the arcade">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''$arcadeNameCaps''<<if $arcadeSlaves >= $arcade>> @@.red;(full)@@<</if>>
<</if>>
<</if>>
<<if ($dairy > 0)>>
|
<<if ($currentRule.setAssignment != "work in the dairy")>>
	<<link $dairyNameCaps>>
		<<set $currentRule.setAssignment = "work in the dairy">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''$dairyNameCaps''<<if $dairySlaves >= $dairy>> @@.red;(full)@@<</if>>
<</if>>
<</if>>
<<if ($servantsQuarters > 0)>>
|
<<if ($currentRule.setAssignment != "work as a servant")>>
	<<link $servantsQuartersNameCaps>>
		<<set $currentRule.setAssignment = "work as a servant">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''$servantsQuartersNameCaps''<<if $servantsQuartersSlaves >= $servantsQuarters>> @@.red;(full)@@<</if>>
<</if>>
<</if>>
<<if ($masterSuite > 0)>>
|
<<if ($currentRule.setAssignment != "serve in the master suite")>>
	<<link $masterSuiteNameCaps>>
		<<set $currentRule.setAssignment = "serve in the master suite">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''$masterSuiteNameCaps''<<if $masterSuiteSlaves >= $masterSuite>> @@.red;(full)@@<</if>>
<</if>>
<</if>>
<<if ($schoolroom > 0)>>
|
<<if ($currentRule.setAssignment != "learn in the schoolroom")>>
	<<link $schoolroomNameCaps>>
		<<set $currentRule.setAssignment = "learn in the schoolroom">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''$schoolroomNameCaps''<<if $schoolroomSlaves >= $schoolroom>> @@.red;(full)@@<</if>>
<</if>>
<</if>>
<<if ($spa > 0)>>
|
<<if ($currentRule.setAssignment != "rest in the spa")>>
	<<link $spaNameCaps>>
		<<set $currentRule.setAssignment = "rest in the spa">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''$spaNameCaps''<<if $spaSlaves >= $spa>> @@.red;(full)@@<</if>>
<</if>>
<</if>>
<<if ($clinic > 0)>>
|
<<if ($currentRule.setAssignment != "get treatment in the clinic")>>
	<<link $clinicNameCaps>>
		<<set $currentRule.setAssignment = "get treatment in the clinic">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''$clinicNameCaps''<<if $clinicSlaves >= $clinic>> @@.red;(full)@@<</if>>
<</if>>
<</if>>
<<if ($cellblock > 0)>>
|
<<if ($currentRule.setAssignment != "be confined in the cellblock")>>
	<<link $cellblockNameCaps>>
		<<set $currentRule.setAssignment = "be confined in the cellblock">>
		<<RANormalizeAssignments "setAssignment">>
	<</link>>
<<else>>
	''$cellblockNameCaps''<<if $cellblockSlaves >= $cellblock>> @@.red;(full)@@<</if>>
<</if>>
<</if>>

<<if _facilityAssignments.includes($currentRule.setAssignment)>>
<br>&nbsp;&nbsp;&nbsp;&nbsp;
Automatically remove from facility when rule stops applying:
<<if $currentRule.facilityRemove>>
	''True'' |
	<<link False>>
		<<set $currentRule.facilityRemove = false>>
		<<RANormalizeAssignments "facilityRemove">>
	<</link>>
<<else>>
	''False'' |
	<<link True>>
		<<set $currentRule.facilityRemove = true>>
		<<RANormalizeAssignments "facilityRemove">>
	<</link>>
<</if>>

<br>&nbsp;&nbsp;&nbsp;&nbsp;
Assignment on removal: ''$currentRule.removalAssignment''
<<if ($currentRule.removalAssignment != "rest")>>
	| <<link "Rest">>
		<<set $currentRule.removalAssignment = "rest">>
		<<RAChangeAssignFacility>>
		<<RARuleModified>>
	<</link>>
<</if>>
<<if ($currentRule.removalAssignment != "please you")>>
	| <<link "Fucktoy">>
		<<set $currentRule.removalAssignment = "please you">>
		<<RAChangeAssignFacility>>
		<<RARuleModified>>
	<</link>>
<</if>>
<<if ($currentRule.removalAssignment != "be a servant")>>
	| <<link "House Servant">>
		<<set $currentRule.removalAssignment = "be a servant">>
		<<RAChangeAssignFacility>>
		<<RARuleModified>>
	<</link>>
<</if>>
<<if ($currentRule.removalAssignment != "stay confined")>>
	| <<link "Confined">>
		<<set $currentRule.removalAssignment = "stay confined">>
		<<RAChangeAssignFacility>>
		<<RARuleModified>>
	<</link>>
<</if>>
<<if ($currentRule.removalAssignment != "whore")>>
	| <<link "Whore">>
		<<set $currentRule.removalAssignment = "whore">>
		<<RAChangeAssignFacility>>
		<<RARuleModified>>
	<</link>>
<</if>>
<<if ($currentRule.removalAssignment != "serve the public")>>
	| <<link "Public Servant">>
		<<set $currentRule.removalAssignment = "serve the public">>
		<<RAChangeAssignFacility>>
		<<RARuleModified>>
	<</link>>
<</if>>
<<if ($currentRule.removalAssignment != "work a glory hole")>>
	| <<link "Gloryhole">>
		<<set $currentRule.removalAssignment = "work a glory hole">>
		<<RAChangeAssignFacility>>
		<<RARuleModified>>
	<</link>>
<</if>>
<</if>>
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RASpecialSlaves>>
%/
<<widget "RASpecialSlaves">>
<<replace #specialslaves>>
<<if $currentRule.excludeSpecialSlaves>>
	Excluding special slaves:
	''True'' |
	<<link False>>
		<<set $currentRule.excludeSpecialSlaves = false>>
		<<RASpecialSlaves>>
		<<RARuleModified>>
	<</link>>
<<else>>
	@@.gray;Exclude special slaves:@@
	''False'' |
	<<link True>>
		<<set $currentRule.excludeSpecialSlaves = true>>
		<<RASpecialSlaves>>
		<<RARuleModified>>
	<</link>>
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RAChangeClothes>>
%/
<<widget "RAChangeClothes">>
<<replace #clothes>>
<<if ($currentRule.clothes == "choosing her own clothes")>>
	''slave's choice.''
<<else>>
	''$currentRule.clothes.''
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RAChangeCollar>>
%/
<<widget "RAChangeCollar">>
<<replace #collar>>
	''$currentRule.collar.''
<</replace>>
<</widget>>

/%
 Call as <<RAChangeShoes>>
%/
<<widget "RAChangeShoes">>
<<replace #shoes>>
	''$currentRule.shoes.''
<</replace>>
<</widget>>

/%
 Call as <<RAChangeBelly>>
%/
<<widget "RAChangeBelly">>
<<replace #baccessory>>
	''$currentRule.bellyAccessory.''
<</replace>>
<</widget>>

/%
 Call as <<RAChangeVAccessory>>
 $arg[0] - 0: virgin, 1: anal virgin, else non-virgin.
%/
<<widget "RAChangeVAccessory">>
<<if $args[0] == 0>>
	<<replace #vaccessory>>
		''$currentRule.virginAccessory.''
	<</replace>>
<<elseif $args[0] == 1>>
	<<replace #avaccessory>>
		''$currentRule.aVirginAccessory.''
	<</replace>>
<<else>>
	<<replace #voaccessory>>
		''$currentRule.vaginalAccessory.''
	<</replace>>
<</if>>
<</widget>>

/%
 Call as <<RAChangeDAccessory>>
 $arg[0] - 0: anal virgin, else non-virgin.
%/
<<widget "RAChangeDAccessory">>
<<if $args[0] == 0>>
	<<replace #avdaccessory>>
		''$currentRule.aVirginDickAccessory.''
	<</replace>>
<<else>>
	<<replace #daccessory>>
		''$currentRule.dickAccessory.''
	<</replace>>
<</if>>
<</widget>>

/%
 Call as <<RAChangeBAccessory>>
 $arg[0] - 0: anal virgin, else non-virgin.
%/
<<widget "RAChangeBAccessory">>
<<if $args[0] == 0>>
	<<replace #avbuaccessory>>
		''$currentRule.aVirginButtplug.''
	<</replace>>
<<else>>
	<<replace #buaccessory>>
		''$currentRule.buttplug.''
	<</replace>>
<</if>>
<</widget>>

/%
 Call as <<RAChangeCuratives>>
%/
<<widget "RAChangeCuratives">>
<<replace #curatives>>
<<if $currentRule.curatives == "no default setting">>
	''no default setting.''
<<elseif $currentRule.curatives > 0>>
	<<if $currentRule.curatives > 1>>
		''curatives.''
	<<else>>
		''preventatives.''
	<</if>>
<<else>>
	''none.''
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RAChangeAphrodisiacs>>
%/
<<widget "RAChangeAphrodisiacs">>
<<replace #aphrodisiacs>>
<<if $currentRule.aphrodisiacs == "no default setting">>
	''no default setting.''
<<elseif $currentRule.aphrodisiacs > 0>>
	<<if $currentRule.aphrodisiacs > 1>>
		''extreme.''
	<<else>>
		''standard.''
	<</if>>
<<elseif $currentRule.aphrodisiacs === -1>>
	''anaphrodisiacs.''
<<else>>
	''none.''
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RAChangePreg>>
%/
<<widget "RAChangePreg">>
<<replace #preg>>
<<if $currentRule.preg == 0>>
	''fertile.''
<<elseif $currentRule.preg == 1>>
	''very fertile.''
<<elseif $currentRule.preg == 2>>
	''extremely fertile.''
<<elseif $currentRule.preg == 3>>
	''hyper fertile.''
<<elseif $currentRule.preg == 4>>
	''just knock my shit up.''
<<elseif $currentRule.preg == -1>>
	''contraceptives.''
<<else>>
	''no default setting.''
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RAChangeXXHormones>>
%/
<<widget "RAChangeXXHormones">>
<<replace #xxhormones>>
<<if $currentRule.XX == 0>>
	''no hormones.''
<<elseif $currentRule.XX == 1>>
	''female.''
<<elseif $currentRule.XX == 2>>
	''intensive female.''
<<elseif $currentRule.XX == -1>>
	''male.''
<<elseif $currentRule.XX == -2>>
	''intensive male.''
<<else>>
	''no default setting.''
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RAChangeXYHormones>>
%/
<<widget "RAChangeXYHormones">>
<<replace #xyhormones>>
<<if $currentRule.XY == 0>>
	''no hormones.''
<<elseif $currentRule.XY == 1>>
	''female.''
<<elseif $currentRule.XY == 2>>
	''intensive female.''
<<elseif $currentRule.XY == -1>>
	''male.''
<<elseif $currentRule.XY == -2>>
	''intensive male.''
<<else>>
	''no default setting.''
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RAChangeGeldHormones>>
%/
<<widget "RAChangeGeldHormones">>
<<replace #geldhormones>>
<<if $currentRule.gelding == 0>>
	''no hormones.''
<<elseif $currentRule.gelding == 1>>
	''female.''
<<elseif $currentRule.gelding == 2>>
	''intensive female.''
<<elseif $currentRule.gelding == -1>>
	''male.''
<<elseif $currentRule.gelding == -2>>
	''intensive male.''
<<else>>
	''no default setting.''
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RAChangeDrugs>>
%/
<<widget "RAChangeDrugs">>
<<if $currentRule.drug == "none">>
	<<set $currentRule.drug = "no drugs">>
<</if>>
<<replace #otherdrugs>>
Other drugs: // Will be overriden by hormones and other drugs where applicable.// ''$currentRule.drug.''
<</replace>>
<</widget>>

/%
 Call as <<RAChangeDiet>>
%/
<<widget "RAChangeDiet">>
<<replace #diet>>
<<if $currentRule.diet == 30>>
	''designed to keep slaves plush.''
<<elseif $currentRule.diet == 0>>
	''designed for average weight.''
<<elseif $currentRule.diet == -30>>
	''designed to keep slaves thin.''
<<elseif $currentRule.diet == "attractive">>
	''fat slaves will slim down to plush; skinny slaves will fill out to thin.''
<<elseif $currentRule.diet == "XY">>
	''designed to promote male development.''
<<elseif $currentRule.diet == "XX">>
	''designed to promote female development.''
<<elseif $currentRule.diet == "XXY">>
	''designed to promote hermaphrodite development.''
<<elseif $currentRule.diet == "cleansing">>
	''designed to promote health.''
<<elseif $currentRule.diet == "fertility">>
	''designed to promote ovulation''
<<elseif $currentRule.diet == "cum production">>
	''designed to promote cum production''
<<else>>
	''no default setting.''
<</if>>
<</replace>>

<<replace #dietsupport>>
<<if $currentRule.diet !== "no default setting">>
<br>&nbsp;&nbsp;&nbsp;&nbsp;
Diet support for growth drugs:
<<if $currentRule.dietGrowthSupport == 1>>
	''on.''
<<else>>
	''off.''
<</if>>

<<link "On">>
	<<set $currentRule.dietGrowthSupport = 1>>
	<<RAChangeDiet>>
<</link>>
|
<<link "Off">>
	<<set $currentRule.dietGrowthSupport = 0>>
	<<RAChangeDiet>>
<</link>>
<</if>>
<</replace>>
<</widget>>

/%
 % Call as <<RAChangeDietBase>>
 %/
<<widget "RAChangeDietBase">>
<<replace #dietBase>>
<<if $currentRule.dietCum == 2>>
	''Cum-Based.''
<<elseif (($currentRule.dietCum == 1) && ($currentRule.dietMilk == 0))>>
	''Cum Added.''
<<elseif (($currentRule.dietCum == 0) && ($currentRule.dietMilk == 1))>>
	''Milk Added.''
<<elseif (($currentRule.dietCum == 1) && ($currentRule.dietMilk == 1))>>
	''Cum & Milk Added.''
<<elseif ($currentRule.dietMilk == 2)>>
	''Milk Based.''
<<elseif (($currentRule.dietCum == 0) && ($currentRule.dietMilk == 0))>>
	''Normal Diet.''
<<else>>
	''no default setting.''
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RAChangeMuscles>>
%/
<<widget "RAChangeMuscles">>
<<replace #muscles>>
<<if $currentRule.muscles > 95>>
	''massive.''
<<elseif $currentRule.muscles > 30>>
	''ripped.''
<<elseif $currentRule.muscles > 5>>
	''toned.''
<<elseif $currentRule.muscles == 0>>
	''none.''
<<else>>
	''no default setting.''
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RAChangeBraces>>
%/
<<widget "RAChangeBraces">>
<<replace #braces>>
<<if $currentRule.teeth == "straighten">>
	''straighten'' teeth, then remove.
<<elseif $currentRule.teeth == "universal">>
	''universally'' applied.
<<elseif $currentRule.teeth == "none">>
	''none.''
<<else>>
	''no default setting.''
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RAChangeAssistantImplants>>
%/
<<widget "RAChangeAssistantImplants">>
<<replace #assistantimplants>>
<<if $currentRule.autoSurgery == 1>>
	''ACTIVE, STAND CLEAR.''
	<<link "Off">>
		<<set $currentRule.autoSurgery = 0>>
		<<RAChangeAssistantImplants>>
		<<RARuleModified>>
	<</link>>
<<else>>
	''off.''
	<<link "Activate">>
		<<set $currentRule.autoSurgery = 1>>
		<<RAChangeAssistantImplants>>
		<<RARuleModified>>
	<</link>>
<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RAChangeLiving>>
%/
<<widget "RAChangeLiving">>
<<replace #living>>
	''$currentRule.livingRules.''
<</replace>>
<</widget>>

/%
 Call as <<RAChangePunish>>
%/
<<widget "RAChangePunish">>
<<replace #punish>>
	''$currentRule.standardPunishment.''
<</replace>>
<</widget>>

/%
 Call as <<RAChangeReward>>
%/
<<widget "RAChangeReward">>
<<replace #reward>>
	''$currentRule.standardReward.''
<</replace>>
<</widget>>

/%
 Call as <<RAChangeMast>>
%/
<<widget "RAChangeMast">>
<<replace #mast>>
	''$currentRule.releaseRules.''
<</replace>>
<</widget>>

/%
 Call as <<RAChangeSPF>>
%/
<<widget "RAChangeSPF">>
<<replace #spf>>
	''$currentRule.clitSetting.''
<</replace>>
<</widget>>

/%
 Call as <<RAChangeSPXY>>
%/
<<widget "RAChangeSPXY">>
<<replace #spxy>>
	<<RAInitSPXY>>
<</replace>>
<</widget>>

<<widget "RAInitSPXY">>
	<<if $currentRule.clitSettingXY == "no default setting">>
		''no default setting.''
	<<elseif $currentRule.clitSettingXY > 95>>
		''passionate.''
	<<elseif $currentRule.clitSettingXY > 70>>
		''attracted.''
	<<elseif $currentRule.clitSettingXY > 30>>
		''indifferent.''
	<<else>>
		''none.''
	<</if>>
<</widget>>

/%
 Call as <<RAChangeSPXX>>
%/
<<widget "RAChangeSPXX">>
<<replace #spxx>>
	<<RAInitSPXX>>
<</replace>>
<</widget>>

<<widget "RAInitSPXX">>
	<<if $currentRule.clitSettingXX == "no default setting">>
		''no default setting.''
	<<elseif $currentRule.clitSettingXX > 95>>
		''passionate.''
	<<elseif $currentRule.clitSettingXX > 70>>
		''attracted.''
	<<elseif $currentRule.clitSettingXX > 30>>
		''indifferent.''
	<<else>>
		''none.''
	<</if>>
<</widget>>

/%
 Call as <<RAChangeSPE>>
%/
<<widget "RAChangeSPE">>
<<replace #spe>>
	<<RAInitSPE>>
<</replace>>
<</widget>>

<<widget "RAInitSPE">>
	<<if $currentRule.clitSettingEnergy == "no default setting">>
		''no default setting.''
	<<elseif $currentRule.clitSettingEnergy > 95>>
		''nympho.''
	<<elseif $currentRule.clitSettingEnergy > 80>>
		''sex addict.''
	<<elseif $currentRule.clitSettingEnergy > 60>>
		''powerful.''
	<<elseif $currentRule.clitSettingEnergy > 40>>
		''healthy.''
	<<elseif $currentRule.clitSettingEnergy > 20>>
		''weak.''
	<<else>>
		''frigid.''
	<</if>>
<</widget>>


/%
 Call as <<RAChangeSpeech>>
%/
<<widget "RAChangeSpeech">>
<<replace #speech>>
	''$currentRule.speechRules.''
<</replace>>
<</widget>>

/%
 Call as <<RAChangeRelationship>>
%/
<<widget "RAChangeRelationship">>
<<replace #relation>>
	''$currentRule.relationshipRules.''
<</replace>>
<</widget>>

/%
 Call as <<RAChangeFameSpending>>
%/
<<widget "RAChangeFameSpending">>
<<replace #pornfame>>
<<if $currentRule.pornFameSpending == -1>>
	Release of feeds showing excellent slaves' sex lives: ''off.''
<<else>>
	Weekly porn publicity subsidy: ''<<print cashFormat($currentRule.pornFameSpending)>>.''
<</if>>
<</replace>>
<</widget>>

/%
 % Call as <<RASaveRule>>
 %/
<<widget "RASaveRule">>
<<replace .saveresult>>
<<for _t = 0; _t < $defaultRules.length; _t++>>
	<<if ($currentRule.ID != $defaultRules[_t].ID)>>
		<<continue>>
	<</if>>

	<<if (def _customCondition)>>
		<<set _parsedCondition = parseCondition(_customCondition)>>
		<<if (_parsedCondition.error)>>
			//There seems to be something wrong with the condition that you have given me sir,
			<br> <<print printError(_customCondition, _parsedCondition.error)>>
			<br> _parsedCondition.error.message//
			<br>
			<<break>>
		<</if>>
		<<set $currentRule.condition = optimizeExpr(_parsedCondition.expr)>>
	<</if>>

	<<set $defaultRules[_t] = $currentRule>>
	//Rule '$currentRule.name' saved//
	<<break>>
<</for>>
<</replace>>
<</widget>>


/%
 % Call as <<RAChangeSave>>
 %/
<<widget "RAChangeSave">>
<<replace .saveresult>>
<<link "Save Rule '$currentRule.name'">>
	<<RASaveRule>>
<</link>>
<</replace>>
<</widget>>

/%
 % Call as <<RAChangeApply>>
 %/
<<widget "RAChangeApply">>
<<replace #applied>>
	/% empty %/
<</replace>>

<<replace #applyresult>>
<<link "Apply rules">>
	<<RASaveRule>>
	<<replace "#applied">>
		<<for _rai = 0; _rai < $slaves.length; _rai++>>
			<<if ($slaves[_rai].useRulesAssistant)>>
				<<ClearSummaryCache $slaves[_rai]>>
				<<CheckAutoRulesActivate $slaves[_rai]>> /* does not use or modify $currentRule */
				<<DefaultRules $slaves[_rai]>>           /* does not use or modify $currentRule */
			<</if>>
		<</for>>
	<</replace>>

	<<replace "#applyresult">>
		//Rules applied.//<br>
	<</replace>>
<</link>>
<</replace>>
<</widget>>

/%
 % <<RARuleModified>>
 %/
<<widget "RARuleModified">>
    <<RAChangeSave>>
    <<RAChangeApply>>
<</widget>>

/%
 Call as <<RAChangeEyewear>>
%/
<<widget "RAChangeEyewear">>
<<replace #eyewear>>
Eyewear: ''$currentRule.eyewear.''
<</replace>>
<</widget>>
/%
 Call as <<RAChangeEyecolor>>
%/
<<widget "RAChangeEyecolor">>
<<replace #eyecolor>>
Eye coloring: ''$currentRule.eyeColor.''
<</replace>>
<</widget>>
/%
 Call as <<RAChangeMakeup>>
%/
<<widget "RAChangeMakeup">>
<<replace #makeup>>
''
<<if $currentRule.makeup == 0>>
	makeup-free.
<<elseif $currentRule.makeup == 1>>
	minimal makeup.
<<elseif $currentRule.makeup == 2>>
	luxurious, expensive makeup.
<<elseif $currentRule.makeup == 3>>
	color-coordinated.
<<elseif $currentRule.makeup == 4>>
	garish.
<<else>>
	no default setting.
<</if>>
''
<</replace>>
<</widget>>
/%
 Call as <<RAChangeNails>>
%/
<<widget "RAChangeNails">>
<<replace #nails>>
''
<<if $currentRule.nails == 0>>
	clipped.
<<elseif $currentRule.nails == 1>>
	long and elegant.
<<elseif $currentRule.nails == 2>>
	color-coordinated.
<<elseif $currentRule.nails == 3>>
	sharp and claw-like.
<<elseif $currentRule.nails == 4>>
	bright and glittery.
<<elseif $currentRule.nails == 5>>
	garish.
<<else>>
	no default setting.
<</if>>
''
<</replace>>
<</widget>>
/%
 Call as <<RAChangeHColor>>
%/
<<widget "RAChangeHColor">>
<<replace #hcolor>>
Hair color: ''$currentRule.hColor.''
<</replace>>
<</widget>>
/%
 Call as <<RAChangeHStyle>>
%/
<<widget "RAChangeHStyle">>
<<replace #hstyle>>
Hair style: ''$currentRule.hStyle.''
<</replace>>
<</widget>>
/%
 Call as <<RAChangeHLength>>
%/
<<widget "RAChangeHLength">>
<<replace #hlength>>
Hair length: ''$currentRule.hLength.''
<</replace>>
<</widget>>
/%
 Call as <<RAChangePHColor>>
%/
<<widget "RAChangePHColor">>
<<replace #phcolor>>
Pubic hair color, when present: ''$currentRule.pubicHColor.''
<</replace>>
<</widget>>
/%
 Call as <<RAChangePHStyle>>
%/
<<widget "RAChangePHStyle">>
<<replace #phstyle>>
Pubic hair style: ''$currentRule.pubicHStyle.''
<</replace>>
<</widget>>
/%
 Call as <<RAChangeAHColor>>
%/
<<widget "RAChangeAHColor">>
<<replace #ahcolor>>
Underarm hair color, when present: ''$currentRule.underArmHColor.''
<</replace>>
<</widget>>
/%
 Call as <<RAChangeAHStyle>>
%/
<<widget "RAChangeAHStyle">>
<<replace #ahstyle>>
Underarm hair style: ''$currentRule.underArmHStyle.''
<</replace>>
<</widget>>
/%
 Call as <<RAChangeEarPiercings>>
%/
<<widget "RAChangeEarPiercings">>
<<replace #earpiercing>>
<<if $currentRule.earPiercing == "no default setting">>No default setting.<<elseif $currentRule.earPiercing == 0>>None.<<elseif $currentRule.earPiercing == 1>>Light.
<<elseif $currentRule.earPiercing == 2>>Heavy.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeNosePiercings>>
%/
<<widget "RAChangeNosePiercings">>
<<replace #nosepiercing>>
<<if $currentRule.nosePiercing == "no default setting">>No default setting.<<elseif $currentRule.nosePiercing == 0>>None.<<elseif $currentRule.nosePiercing == 1>>Light.
<<elseif $currentRule.nosePiercing == 2>>Heavy.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeEybrowPiercings>>
%/
<<widget "RAChangeEyebrowPiercings">>
<<replace #eyebrowpiercing>>
<<if $currentRule.eyebrowPiercing == "no default setting">>No default setting.<<elseif $currentRule.eyebrowPiercing == 0>>None.<<elseif $currentRule.eyebrowPiercing == 1>>Light.
<<elseif $currentRule.eyebrowPiercing == 2>>Heavy.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeNavelPiercings>>
%/
<<widget "RAChangeNavelPiercings">>
<<replace #navelpiercing>>
<<if $currentRule.navelPiercing == "no default setting">>No default setting.<<elseif $currentRule.navelPiercing == 0>>None.<<elseif $currentRule.navelPiercing == 1>>Light.
<<elseif $currentRule.navelPiercing == 2>>Heavy.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeNipplePiercings>>
%/
<<widget "RAChangeNipplePiercings">>
<<replace #nipplepiercing>>
<<if $currentRule.nipplesPiercing == "no default setting">>No default setting.<<elseif $currentRule.nipplesPiercing == 0>>None.<<elseif $currentRule.nipplesPiercing == 1>>Light.
<<elseif $currentRule.nipplesPiercing == 2>>Heavy.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeAreolaPiercings>>
%/
<<widget "RAChangeAreolaPiercings">>
<<replace #areolapiercing>>
<<if $currentRule.areolaePiercing == "no default setting">>No default setting.<<elseif $currentRule.areolaePiercing == 0>>None.<<elseif $currentRule.areolaePiercing == 1>>Studded.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeLipPiercings>>
%/
<<widget "RAChangeLipPiercings">>
<<replace #lippiercing>>
<<if $currentRule.lipsPiercing == "no default setting">>No default setting.<<elseif $currentRule.lipsPiercing == 0>>None.<<elseif $currentRule.lipsPiercing == 1>>Light.
<<elseif $currentRule.lipsPiercing == 2>>Heavy.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeTonguePiercings>>
%/
<<widget "RAChangeTonguePiercings">>
<<replace #tonguepiercing>>
<<if $currentRule.tonguePiercing == "no default setting">>No default setting.<<elseif $currentRule.tonguePiercing == 0>>None.<<elseif $currentRule.tonguePiercing == 1>>Light.
<<elseif $currentRule.tonguePiercing == 2>>Heavy.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeClitPiercings>>
%/
<<widget "RAChangeClitPiercings">>
<<replace #clitpiercing>>
<<if $currentRule.clitPiercing == "no default setting">>No default setting.<<elseif $currentRule.clitPiercing == 0>>None.<<elseif $currentRule.clitPiercing == 1>>Light.
<<elseif $currentRule.clitPiercing == 2>>Heavy.
<<elseif $currentRule.clitPiercing == 3>>Smart.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeVaginaPiercings>>
%/
<<widget "RAChangeVaginaPiercings">>
<<replace #vaginapiercing>>
<<if $currentRule.vaginaPiercing == "no default setting">>No default setting.<<elseif $currentRule.vaginaPiercing == 0>>None.<<elseif $currentRule.vaginaPiercing == 1>>Light.
<<elseif $currentRule.vaginaPiercing == 2>>Heavy.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeDickPiercings>>
%/
<<widget "RAChangeDickPiercings">>
<<replace #dickpiercing>>
<<if $currentRule.dickPiercing == "no default setting">>No default setting.<<elseif $currentRule.dickPiercing == 0>>None.<<elseif $currentRule.dickPiercing == 1>>Light.
<<elseif $currentRule.dickPiercing == 2>>Heavy.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeAnusPiercings>>
%/
<<widget "RAChangeAnusPiercings">>
<<replace #anuspiercing>>
<<if $currentRule.anusPiercing == "no default setting">>No default setting.<<elseif $currentRule.anusPiercing == 0>>None.<<elseif $currentRule.anusPiercing == 1>>Light.
<<elseif $currentRule.anusPiercing == 2>>Heavy.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeCorsetPiercings>>
%/
<<widget "RAChangeCorsetPiercings">>
<<replace #corsetpiercing>>
<<if $currentRule.corsetPiercing == "no default setting">>No default setting.<<elseif $currentRule.corsetPiercing == 0>>None.<<elseif $currentRule.corsetPiercing == 1>>Applied.<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeBranding>>
%/
<<widget "RAChangeBranding">>
<<replace #branding>>
<<if $currentRule.autoBrand == 1>>
	''on.''
	<<link "Deactivate">>
		<<set $currentRule.autoBrand = 0>>
		<<RAChangeBranding>>
	<</link>>
<<else>>
	''off.''
	<<link "Activate">>
		<<set $currentRule.autoBrand = 1>>
		<<RAChangeBranding>>
	<</link>>
<</if>>
<</replace>>
<</widget>>
/%
 Call as <<RAChangeBrandTarget>>
%/
<<widget "RAChangeBrandTarget">>
<<replace #brandtarget>>
Your preferred location for brands is the ''$brandTarget.''
<</replace>>
<</widget>>
/%
 Call as <<RAChangeBrandDesign>>
%/
<<widget "RAChangeBrandDesign">>
<<replace #branddesign>>
Your brand design is ''$brandDesign.''
<</replace>>
<</widget>>
/%
 Call as <<RAChangeChestTattoos>>
%/
<<widget "RAChangeChestTattoos">>
<<replace #chesttattoo>>
<<if $currentRule.boobsTat == 0>>none<<else>>$currentRule.boobsTat<</if>>.
<</replace>>
<</widget>>
/%
 Call as <<RAChangeButtTattoos>>
%/
<<widget "RAChangeButtTattoos">>
<<replace #butttattoo>>
<<if $currentRule.buttTat == 0>>none<<else>>$currentRule.buttTat<</if>>.
<</replace>>
<</widget>>
/%
 Call as <<RAChangeFaceTattoos>>
%/
<<widget "RAChangeFaceTattoos">>
<<replace #facetattoo>>
<<if $currentRule.lipsTat == 0>>none<<else>>$currentRule.lipsTat<</if>>.
<</replace>>
<</widget>>
/%
 Call as <<RAChangeShoulderTattoos>>
%/
<<widget "RAChangeShoulderTattoos">>
<<replace #shouldertattoo>>
<<if $currentRule.shouldersTat == 0>>none<<else>>$currentRule.shouldersTat<</if>>.
<</replace>>
<</widget>>
/%
 Call as <<RAChangeArmTattoos>>
%/
<<widget "RAChangeArmTattoos">>
<<replace #armtattoo>>
<<if $currentRule.armsTat == 0>>none<<else>>$currentRule.armsTat<</if>>.
<</replace>>
<</widget>>
/%
 Call as <<RAChangeLegTattoos>>
%/
<<widget "RAChangeLegTattoos">>
<<replace #legtattoo>>
<<if $currentRule.legsTat == 0>>none<<else>>$currentRule.legsTat<</if>>.
<</replace>>
<</widget>>
/%
 Call as <<RAChangeBackTattoos>>
%/
<<widget "RAChangeBackTattoos">>
<<replace #backtattoo>>
<<if $currentRule.backTat == 0>>none<<else>>$currentRule.backTat<</if>>.
<</replace>>
<</widget>>
/%
 Call as <<RAChangeStampTattoos>>
%/
<<widget "RAChangeStampTattoos">>
<<replace #stamptattoo>>
<<if $currentRule.stampTat == 0>>none<<else>>$currentRule.stampTat<</if>>.
<</replace>>
<</widget>>
/%
 Call as <<RAChangeVaginaTattoos>>
%/
<<widget "RAChangeVaginaTattoos">>
<<replace #vaginatattoo>>
<<if $currentRule.vaginaTat == 0>>none<<else>>$currentRule.vaginaTat<</if>>.
<</replace>>
<</widget>>
/%
 Call as <<RAChangeDickTattoos>>
%/
<<widget "RAChangeDickTattoos">>
<<replace #dicktattoo>>
<<if $currentRule.dickTat == 0>>none<<else>>$currentRule.dickTat<</if>>.
<</replace>>
<</widget>>
/%
 Call as <<RAChangeAnusTattoos>>
%/
<<widget "RAChangeAnusTattoos">>
<<replace #anustattoo>>
<<if $currentRule.anusTat == 0>>none<<else>>$currentRule.anusTat<</if>>.
<</replace>>
<</widget>>


/%
 Call as <<RASurgeryChangeEyes>>
%/
<<widget "RASurgeryChangeEyes">>
<<replace #eyes>>
	<<if ($currentRule.surgery.eyes == -1)>>
		''blurred.''
	<<elseif ($currentRule.surgery.eyes == 1)>>
		''fixed.''
	<<else>>
		''no default setting.''
		
	<</if>>

	<br>

	<<if ($currentRule.surgery.eyes !== "no default setting")>>
		<<link "No default setting">>
			<<set $currentRule.surgery.eyes = "no default setting">>
			<<RASurgeryChangeEyes>>
		<</link>> |
	<<else>>
		No default setting |
	<</if>>
	<<if ($currentRule.surgery.eyes !== 1)>>
		<<link "Corrected">>
			<<set $currentRule.surgery.eyes = 1>>
			<<RASurgeryChangeEyes>>
		<</link>> |
	<<else>>
		Corrected |
	<</if>>
	<<if ($currentRule.surgery.eyes !== -1)>>
		<<link "Blurred">>
			<<set $currentRule.surgery.eyes = -1>>
			<<RASurgeryChangeEyes>>
		<</link>>
	<<else>>
		Blurred
	<</if>>
<</replace>>
<</widget>>

<<widget "DefaultRules">>
	<<= DefaultRules($args[0]) >>
<</widget>>

/%
 Call as <<RASurgeryChangeLactation>>
%/
<<widget "RASurgeryChangeLactation">>
<<replace #lactation>>
	<<if ($currentRule.surgery.lactation == "no default setting")>>
		''no default setting.''
	<<elseif ($currentRule.surgery.lactation == 1)>>
		''implanted.''
	<<else>>
		''implants will be removed.''
	<</if>>

	<br>

	<<if ($currentRule.surgery.lactation !== "no default setting")>>
		<<link "No default setting">>
			<<set $currentRule.surgery.lactation = "no default setting">>
			<<RASurgeryChangeLactation>>
		<</link>> |
	<<else>>
		No default setting |
	<</if>>
	<<if ($currentRule.surgery.lactation !== 0)>>
		<<link "Removed">>
			<<set $currentRule.surgery.lactation = 0>>
			<<RASurgeryChangeLactation>>
		<</link>> |
	<<else>>
		Removed |
	<</if>>
	<<if ($currentRule.surgery.lactation !== 1)>>
		<<link "Implanted">>
			<<set $currentRule.surgery.lactation = 1>>
			<<RASurgeryChangeLactation>>
		<</link>>
	<<else>>
		Implanted
	<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RASurgeryChangeProstate>>
%/
<<widget "RASurgeryChangeProstate">>
<<replace #prostate>>
	<<if ($currentRule.surgery.prostate == "no default setting")>>
		''no default setting.''
	<<elseif ($currentRule.surgery.prostate == 1)>>
		''implanted.''
	<<else>>
		''implants will be removed.''
	<</if>>

	<br>

	<<if ($currentRule.surgery.prostate !== "no default setting")>>
		<<link "No default setting">>
			<<set $currentRule.surgery.prostate = "no default setting">>
			<<RASurgeryChangeProstate>>
		<</link>> |
	<<else>>
		No default setting |
	<</if>>
	<<if ($currentRule.surgery.prostate !== 0)>>
		<<link "Removed">>
			<<set $currentRule.surgery.prostate = 0>>
			<<RASurgeryChangeProstate>>
		<</link>> |
	<<else>>
		Removed |
	<</if>>
	<<if ($currentRule.surgery.prostate !== 1)>>
		<<link "Implanted">>
			<<set $currentRule.surgery.prostate = 1>>
			<<RASurgeryChangeProstate>>
		<</link>>
	<<else>>
		Implanted
	<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RASurgeryChangeCosmetic>>
%/
<<widget "RASurgeryChangeCosmetic">>
<<replace #cosmetic>>
	<<if ($currentRule.surgery.cosmetic == 2)>>
		''invasive.''
	<<elseif ($currentRule.surgery.cosmetic == 1)>>
		''subtle.''
	<<elseif $currentRule.surgery.cosmetic == 0>>
		''none.''
	<<else>>
		''off.''
	<</if>>

	<br>

	<<if ($currentRule.surgery.cosmetic !== "nds")>>
		<<link "No default setting">>
			<<set $currentRule.surgery.cosmetic = "nds">>
			<<RASurgeryChangeCosmetic>>
		<</link>> |
	<<else>>
		Off |
	<</if>>
	<<if ($currentRule.surgery.cosmetic !== 0)>>
		<<link "None">>
			<<set $currentRule.surgery.cosmetic = 0>>
			<<RASurgeryChangeCosmetic>>
		<</link>> |
	<<else>>
		None |
	<</if>>
	<<if ($currentRule.surgery.cosmetic !== 1)>>
		<<link "Subtle">>
			<<set $currentRule.surgery.cosmetic = 1>>
			<<RASurgeryChangeCosmetic>>
		<</link>> |
	<<else>>
		Subtle |
	<</if>>
	<<if ($currentRule.surgery.cosmetic !== 2)>>
		<<link "Invasive">>
			<<set $currentRule.surgery.cosmetic = 2>>
			<<RASurgeryChangeCosmetic>>
		<</link>>
	<<else>>
		Invasive
	<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RASurgeryChangeLips>>
%/
<<widget "RASurgeryChangeLips">>
<<replace #lips>>
	<<if ($currentRule.surgery.lips == "no default setting")>>
		''no default setting.''
	<<elseif ($currentRule.surgery.lips == 95)>>
		implanted until a ''facepussy.''
	<<elseif ($currentRule.surgery.lips == 70)>>
		implanted until ''huge.''
	<<elseif ($currentRule.surgery.lips == 40)>>
		implanted until ''big.''
	<<elseif ($currentRule.surgery.lips == 20)>>
		implanted until ''plush.''
	<<else>>
		''implants will be removed.''
	<</if>>

	<br>

	<<if ($currentRule.surgery.lips !== "no default setting")>>
		<<link "No default setting">>
		<<set $currentRule.surgery.lips = "no default setting">>
		<<RASurgeryChangeLips>>
		<</link>> |
	<<else>>
		No default setting |
	<</if>>
	<<if ($currentRule.surgery.lips != 0)>>
		<<link "Removed">>
		<<set $currentRule.surgery.lips = 0>>
		<<RASurgeryChangeLips>>
		<</link>> |
	<<else>>
		Removed |
	<</if>>
	<<if ($currentRule.surgery.lips != 20)>>
		<<link "Plush">>
		<<set $currentRule.surgery.lips = 20>>
		<<RASurgeryChangeLips>>
		<</link>> |
	<<else>>
		Plush |
	<</if>>
	<<if ($currentRule.surgery.lips != 40)>>
		<<link "Big">>
		<<set $currentRule.surgery.lips = 40>>
		<<RASurgeryChangeLips>>
		<</link>> |
	<<else>>
		Big |
	<</if>>
	<<if ($currentRule.surgery.lips != 70)>>
		<<link "Huge">>
		<<set $currentRule.surgery.lips = 70>>
		<<RASurgeryChangeLips>>
		<</link>>
	<<else>>
		Huge
	<</if>>
	<<if ($seeExtreme != 0)>>
	<<if ($currentRule.surgery.lips != 95)>>
		| <<link "Facepussy">>
		<<set $currentRule.surgery.lips = 95>>
		<<RASurgeryChangeLips>>
		<</link>>
	<<else>>
		| Facepussy
	<</if>>
	<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RASurgeryChangeButt>>
%/
<<widget "RASurgeryChangeButt">>
<<replace #butt>>
	<<if ($currentRule.surgery.butt == "no default setting")>>
		''no default setting.''
	<<elseif ($currentRule.surgery.butt == 9)>>
		implanted until ''maximized.''
	<<elseif ($currentRule.surgery.butt == 6)>>
		implanted until ''huge.''
	<<elseif ($currentRule.surgery.butt == 4)>>
		implanted until ''stacked.''
	<<elseif ($currentRule.surgery.butt == 2)>>
		implanted until ''slim.''
	<<else>>
		''implants will be removed.''
	<</if>>

	<br>

	<<if ($currentRule.surgery.butt !== "no default setting")>>
		<<link "No default setting">>
		<<set $currentRule.surgery.butt = "no default setting">>
		<<RASurgeryChangeButt>>
		<</link>> |
	<<else>>
		No default setting |
	<</if>>
	<<if ($currentRule.surgery.butt != 0)>>
		<<link "Removed">>
		<<set $currentRule.surgery.butt = 0>>
		<<RASurgeryChangeButt>>
		<</link>> |
	<<else>>
		Removed |
	<</if>>
	<<if ($currentRule.surgery.butt != 2)>>
		<<link "Slim">>
		<<set $currentRule.surgery.butt = 2>>
		<<RASurgeryChangeButt>>
		<</link>> |
	<<else>>
		Slim |
	<</if>>
	<<if ($currentRule.surgery.butt != 4)>>
		<<link "Stacked">>
		<<set $currentRule.surgery.butt = 4>>
		<<RASurgeryChangeButt>>
		<</link>> |
	<<else>>
		Stacked |
	<</if>>
	<<if ($currentRule.surgery.butt != 6)>>
		<<link "Huge">>
		<<set $currentRule.surgery.butt = 6>>
		<<RASurgeryChangeButt>>
		<</link>> |
	<<else>>
		Huge |
	<</if>>
	<<if ($currentRule.surgery.butt != 9)>>
		<<link "Maximize">>
		<<set $currentRule.surgery.butt = 9>>
		<<RASurgeryChangeButt>>
		<</link>>
	<<else>>
		Maximize
	<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RASurgeryChangeBoobs>>
%/
<<widget "RASurgeryChangeBoobs">>
<<replace #boobs>>
	<<if ($currentRule.surgery.boobs == "no default setting")>>
		''no default setting.''
	<<elseif ($currentRule.surgery.boobs == 48000)>>
		implanted until ''maximized.''
	<<elseif ($currentRule.surgery.boobs == 9000)>>
		implanted to maximally ''functional,'' where more would immobilize the slave.
	<<elseif ($currentRule.surgery.boobs == 2000)>>
		implanted until ''huge.''
	<<elseif ($currentRule.surgery.boobs == 1000)>>
		implanted until ''stacked.''
	<<elseif ($currentRule.surgery.boobs == 400)>>
		implanted until ''slim.''
	<<else>>
		''implants will be removed.''
	<</if>>

	<br>

	<<if ($currentRule.surgery.boobs != "no default setting")>>
		<<link "No default setting">>
		<<set $currentRule.surgery.boobs = "no default setting">>
		<<RASurgeryChangeBoobs>>
		<</link>> |
	<<else>>
		No default setting |
	<</if>>
	<<if ($currentRule.surgery.boobs != 0)>>
		<<link "Removed">>
		<<set $currentRule.surgery.boobs = 0>>
		<<RASurgeryChangeBoobs>>
		<</link>> |
	<<else>>
		Removed |
	<</if>>
	<<if ($currentRule.surgery.boobs != 400)>>
		<<link "Slim">>
		<<set $currentRule.surgery.boobs = 400>>
		<<RASurgeryChangeBoobs>>
		<</link>> |
	<<else>>
		Slim |
	<</if>>
	<<if ($currentRule.surgery.boobs != 1000)>>
		<<link "Stacked">>
		<<set $currentRule.surgery.boobs = 1000>>
		<<RASurgeryChangeBoobs>>
		<</link>> |
	<<else>>
		Stacked |
	<</if>>
	<<if ($currentRule.surgery.boobs != 2000)>>
		<<link "Huge">>
		<<set $currentRule.surgery.boobs = 2000>>
		<<RASurgeryChangeBoobs>>
		<</link>> |
	<<else>>
		Huge |
	<</if>>
	<<if ($currentRule.surgery.boobs != 9000)>>
		<<link "Functional">>
		<<set $currentRule.surgery.boobs = 9000>>
		<<RASurgeryChangeBoobs>>
		<</link>> |
	<<else>>
		Functional |
	<</if>>
	<<if ($currentRule.surgery.boobs != 48000)>>
		<<link "Maximize">>
		<<set $currentRule.surgery.boobs = 48000>>
		<<RASurgeryChangeBoobs>>
		<</link>>
	<<else>>
		Maximize
	<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RASurgeryChangeHoles>>
%/
<<widget "RASurgeryChangeHoles">>
<<replace #holes>>
	<<if ($currentRule.surgery.holes == 2)>>
		''virginity restoration'' will be applied where possible.
	<<elseif ($currentRule.surgery.holes == 1)>>
		''hole tightening'' will be applied.
	<<else>>
		''No default setting.''
	<</if>>

	<br>
	<<if ($currentRule.surgery.holes != "nds")>>
		<<link "No default setting">>
		<<set $currentRule.surgery.holes = "nds">>
		<<RASurgeryChangeHoles>>
		<</link>> |
	<<else>>
		No default setting |
	<</if>>
	<<if ($currentRule.surgery.holes != 1)>>
		<<link "Tightening">>
		<<set $currentRule.surgery.holes = 1>>
		<<RASurgeryChangeHoles>>
		<</link>> |
	<<else>>
		Tightening |
	<</if>>
	<<if ($currentRule.surgery.holes != 2)>>
		<<link "Virginity">>
		<<set $currentRule.surgery.holes = 2>>
		<<RASurgeryChangeHoles>>
		<</link>>
	<<else>>
		Virginity
	<</if>>
<</replace>>
<</widget>>

/%
 Call as <<RASurgeryBodyHair>>
%/
<<widget "RASurgeryBodyHair">>
<<replace #bodyhair>>
	<<if ($currentRule.surgery.bodyhair == 2)>>
		''Removal''
	<<elseif ($currentRule.surgery.bodyhair == 1)>>
		''Keep''
	<<else>>
		''No default setting.''
	<</if>>

	<br>
	<<if ($currentRule.surgery.bodyhair != "nds")>>
		<<link "No default setting">>
		<<set $currentRule.surgery.bodyhair = "nds">>
		<<RASurgeryBodyHair>>
		<</link>> |
	<<else>>
		No default setting |
	<</if>>

	<<if ($currentRule.surgery.bodyhair != 1)>>
		<<link "Keep">>
		<<set $currentRule.surgery.bodyhair = 1>>
		<<RASurgeryBodyHair>>
		<</link>> |
	<<else>>
		Keep |
	<</if>>

	<<if ($currentRule.surgery.bodyhair != 2)>>
		<<link "Removal">>
		<<set $currentRule.surgery.bodyhair = 2>>
		<<RASurgeryBodyHair>>
		<</link>>
	<<else>>
		Removal
	<</if>>
<</replace>>
<</widget>>


/%
 Call as <<RASurgeryHair>>
%/
<<widget "RASurgeryHair">>
<<replace #hair>>
	<<if ($currentRule.surgery.hair == 2)>>
		''Removal''
	<<elseif ($currentRule.surgery.hair == 1)>>
		''Keep''
	<<else>>
		''No default setting.''
	<</if>>

	<br>
	<<if ($currentRule.surgery.hair != "nds")>>
		<<link "No default setting">>
		<<set $currentRule.surgery.hair = "nds">>
		<<RASurgeryHair>>
		<</link>> |
	<<else>>
		No default setting |
	<</if>>

	<<if ($currentRule.surgery.hair != 1)>>
		<<link "Keep">>
		<<set $currentRule.surgery.hair = 1>>
		<<RASurgeryHair>>
		<</link>> |
	<<else>>
		Keep |
	<</if>>

	<<if ($currentRule.surgery.hair != 2)>>
		<<link "Removal">>
		<<set $currentRule.surgery.hair = 2>>
		<<RASurgeryHair>>
		<</link>>
	<<else>>
		Removal
	<</if>>
<</replace>>
<</widget>>


/%
 % Call as <<CheckAutoRulesActivate SlaveObject>>
 % Does not use or modify $currentRule
 %/
<<widget "CheckAutoRulesActivate">>
	<<= CheckAutoRulesActivate($args[0]) >>
<</widget>>

/*
	Call as <<RulesDeconfliction SlaveObject>>
	Saves the slave, silently fires the RA, saves the slave's after-RA state, and then reverts the slave.
	Call and then check potential change against $slaveAfterRA to see if the RA would revert it.
*/
<<widget "RulesDeconfliction">>

<<set _slaveBeforeRA = clone($args[0])>>
<<silently>>
	<<CheckAutoRulesActivate $args[0]>>
	<<DefaultRules $args[0]>>
<</silently>>
<<set $slaveAfterRA = clone($args[0])>>
<<set $args[0] = _slaveBeforeRA>>

<</widget>>

